<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Wydarzenia, Koncerty, Teatry - EventFinder | 125K+ Event贸w Worldwide</title>
    <meta name="title" content="Wydarzenia, Koncerty, Teatry - EventFinder | 125K+ Event贸w Worldwide">
    <meta name="description" content=" Znajd藕 najlepsze wydarzenia w Polsce i na wiecie! 125,000+ koncert贸w, teatr贸w, festiwali. Bilety online, recenzje, mapa wydarze. Tw贸j event czeka!">
    <meta name="keywords" content="wydarzenia warszawa, koncerty polska, bilety teatr, festiwale muzyczne, eventy weekend, klub muzyczny, spektakle, eventfinder, ticketmaster">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Polish">
    <meta name="author" content="EventFinder">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://eventfinder.fun/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eventfinder.fun/">
    <meta property="og:title" content="EventFinder - Discover the Best Events and Concerts Worldwide">
    <meta property="og:description" content=" Discover 125K+ events worldwide! Concerts, theaters, sports and cultural events. Online tickets, user reviews, event map.">
    <meta property="og:image" content="https://eventfinder.fun/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="EventFinder">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://eventfinder.fun/">
    <meta property="twitter:title" content="EventFinder - Discover the Best Events and Concerts">
    <meta property="twitter:description" content=" Discover 125K+ events worldwide! Concerts, theaters, sports and cultural events.">
    <meta property="twitter:image" content="https://eventfinder.fun/images/og-image.jpg">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="theme-color" content="#6C5CE7">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Google AdSense (publisher ID inserted) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9110227480064306" crossorigin="anonymous"></script>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "EventFinder",
        "description": "Find the best events, concerts and shows worldwide",
        "url": "https://eventfinder.fun",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://eventfinder.fun/?search={search_term_string}",
            "query-input": "required name=search_term_string"
        },
        "publisher": {
            "@type": "Organization",
            "name": "EventFinder",
            "url": "https://eventfinder.fun"
        }
    }
    </script>
    
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "EventFinder",
        "description": "Platform for searching events worldwide",
        "url": "https://eventfinder.fun",
        "applicationCategory": "Entertainment",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "description": "Free event search"
        },
        "featureList": [
            "Global event search",
            "Interactive map",
            "User reviews", 
            "Recommendation system",
            "Newsletter and notifications"
        ]
    }
    </script>
    
    <style>
        :root {
            --primary-purple: #6C5CE7;
            --primary-pink: #FD79A8;
            --primary-orange: #FF7675;
            --primary-blue: #74B9FF;
            --primary-cyan: #00D4FF;
            --primary-violet: #9D4EDD;
            --primary-magenta: #FF006E;
            --dark-bg: #0A0E27;
            --darker-bg: #050815;
            --card-bg: #1A1D3A;
            --card-hover: #252A4A;
            --text-light: #FFFFFF;
            --text-gray: #B0B3C1;
            --text-muted: #6B728E;
            --accent-gold: #FDCB6E;
            --success-green: #00B894;
            --neon-blue: #00FFFF;
            --neon-pink: #FF1493;
            --neon-green: #39FF14;
            --gradient-primary: linear-gradient(135deg, #6C5CE7 0%, #A29BFE 25%, #FD79A8 50%, #FF006E 75%, #00D4FF 100%);
            --gradient-card: linear-gradient(145deg, rgba(26, 29, 58, 0.9) 0%, rgba(45, 53, 97, 0.95) 50%, rgba(26, 29, 58, 0.9) 100%);
            --gradient-text: linear-gradient(45deg, #6C5CE7, #FD79A8, #00D4FF, #9D4EDD);
            --gradient-neon: linear-gradient(90deg, #00FFFF, #FF1493, #39FF14, #00FFFF);
            --gradient-aurora: linear-gradient(125deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            --shadow-purple: 0 20px 60px rgba(108, 92, 231, 0.4);
            --shadow-card: 0 20px 50px rgba(0, 0, 0, 0.5);
            --shadow-neon: 0 0 20px currentColor, 0 0 40px currentColor, 0 0 60px currentColor;
            --shadow-glow: 0 5px 25px rgba(108, 92, 231, 0.3);
            --blur-strong: blur(25px);
            --blur-medium: blur(15px);
            --blur-light: blur(10px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--darker-bg);
            color: var(--text-light);
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }

        /* Ultra Advanced Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: radial-gradient(ellipse at center, var(--dark-bg) 0%, var(--darker-bg) 100%);
            overflow: hidden;
        }

        .animated-bg::before {
            content: '';
            position: absolute;
            width: 300%;
            height: 300%;
            top: -100%;
            left: -100%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(108, 92, 231, 0.15) 0%, transparent 60%),
                radial-gradient(circle at 85% 75%, rgba(253, 121, 168, 0.12) 0%, transparent 60%),
                radial-gradient(circle at 45% 85%, rgba(0, 212, 255, 0.08) 0%, transparent 60%),
                radial-gradient(circle at 75% 15%, rgba(157, 78, 221, 0.1) 0%, transparent 60%),
                radial-gradient(circle at 25% 65%, rgba(255, 0, 110, 0.05) 0%, transparent 60%);
            animation: aurora 25s ease-in-out infinite;
        }

        .animated-bg::after {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: 
                conic-gradient(from 0deg at 30% 40%, rgba(108, 92, 231, 0.1), transparent, rgba(253, 121, 168, 0.08), transparent, rgba(0, 212, 255, 0.06)),
                conic-gradient(from 180deg at 70% 60%, rgba(157, 78, 221, 0.08), transparent, rgba(255, 0, 110, 0.05), transparent);
            animation: aurora-reverse 30s ease-in-out infinite reverse;
        }

        @keyframes aurora {
            0%, 100% { 
                transform: translate(-50%, -50%) rotate(0deg) scale(1);
                opacity: 0.8;
            }
            25% { 
                transform: translate(-40%, -60%) rotate(90deg) scale(1.1);
                opacity: 1;
            }
            50% { 
                transform: translate(-60%, -40%) rotate(180deg) scale(0.9);
                opacity: 0.9;
            }
            75% { 
                transform: translate(-45%, -55%) rotate(270deg) scale(1.05);
                opacity: 0.95;
            }
        }

        @keyframes aurora-reverse {
            0%, 100% { 
                transform: translate(-50%, -50%) rotate(360deg) scale(1.2);
            }
            50% { 
                transform: translate(-55%, -45%) rotate(180deg) scale(0.8);
            }
        }

        /* Ultra Modern Header */
        .header {
            background: rgba(26, 29, 58, 0.7);
            backdrop-filter: var(--blur-strong);
            border-bottom: 1px solid rgba(108, 92, 231, 0.3);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
            opacity: 0.6;
        }

        .header.scrolled {
            background: rgba(5, 8, 21, 0.95);
            backdrop-filter: var(--blur-strong);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border-bottom-color: rgba(108, 92, 231, 0.5);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2.2rem;
            font-weight: 900;
            background: var(--gradient-text);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease-in-out infinite;
            text-shadow: var(--shadow-glow);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 20px rgba(108, 92, 231, 0.6));
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-gray);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            overflow: hidden;
        }

        .nav-links a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0.1;
            transition: all 0.4s ease;
            z-index: -1;
        }

        .nav-links a:hover {
            color: var(--text-light);
            transform: translateY(-3px);
            text-shadow: 0 0 15px rgba(108, 92, 231, 0.8);
        }

        .nav-links a:hover::before {
            left: 0;
            opacity: 0.2;
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--gradient-primary);
            transition: all 0.4s ease;
            transform: translateX(-50%);
        }

        .nav-links a:hover::after {
            width: 80%;
        }

        /* Language Switcher Styles */
        .language-switcher {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .lang-btn {
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-medium);
            border: 2px solid rgba(108, 92, 231, 0.3);
            color: var(--text-gray);
            padding: 0.6rem 1rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .lang-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: all 0.3s ease;
            z-index: -1;
        }

        .lang-btn:hover {
            color: var(--text-light);
            border-color: var(--primary-purple);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3);
        }

        .lang-btn:hover::before {
            left: 0;
        }

        .lang-btn.active {
            background: var(--gradient-primary);
            color: var(--text-light);
            border-color: var(--primary-cyan);
            box-shadow: 0 5px 20px rgba(108, 92, 231, 0.4);
        }

        .lang-btn.active::before {
            left: 0;
        }

        /* Responsive adjustments for language switcher */
        @media (max-width: 768px) {
            .language-switcher {
                gap: 0.3rem;
            }
            
            .lang-btn {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .nav-container {
                flex-wrap: wrap;
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .nav-links {
                gap: 1.5rem;
            }
            
            .language-switcher {
                order: 1;
                width: 100%;
                justify-content: center;
                margin-top: 1rem;
            }
        }

        /* Main Content */
        .main-content {
            margin-top: 100px;
            min-height: 100vh;
        }

        /* Hero Section Enhanced */
        .hero {
            text-align: center;
            padding: 6rem 2rem 4rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(108, 92, 231, 0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse-glow 4s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes pulse-glow {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 0.5;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0.8;
            }
        }

        .hero h1 {
            font-size: 5rem;
            font-weight: 900;
            background: var(--gradient-text);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            animation: slideInDown 1.2s cubic-bezier(0.4, 0, 0.2, 1), gradient-flow 6s ease-in-out infinite;
            text-shadow: 0 0 40px rgba(108, 92, 231, 0.3);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }

        .hero p {
            font-size: 1.4rem;
            color: var(--text-gray);
            margin-bottom: 3rem;
            animation: slideInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            font-weight: 300;
        }

        @keyframes slideInDown {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Global Events Counter */
        .global-counter-section {
            padding: 2rem 2rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: slideInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.4s both;
        }

        .global-counter-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            flex-wrap: wrap;
        }

        .counter-widget {
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-strong);
            border-radius: 25px;
            padding: 2.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(108, 92, 231, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            min-width: 320px;
            overflow: hidden;
        }

        .counter-widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(108, 92, 231, 0.1), transparent);
            animation: shimmer 4s infinite;
        }

        .counter-icon {
            font-size: 3rem;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .counter-content {
            flex: 1;
        }

        .counter-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .counter-number {
            font-size: 2.8rem;
            font-weight: 900;
            background: var(--gradient-text);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 6s ease-in-out infinite, count-pulse 2s ease-in-out infinite;
            line-height: 1;
        }

        @keyframes count-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .counter-sublabel {
            color: var(--text-gray);
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        .counter-pulse {
            position: absolute;
            top: 50%;
            right: 1.5rem;
            width: 12px;
            height: 12px;
            background: var(--primary-purple);
            border-radius: 50%;
            animation: pulse-dot 2s ease-in-out infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { 
                transform: translateY(-50%) scale(1);
                opacity: 1;
            }
            50% { 
                transform: translateY(-50%) scale(1.5);
                opacity: 0.7;
            }
        }

        .counter-stats {
            display: flex;
            gap: 2rem;
        }

        .stat-item {
            text-align: center;
            background: rgba(108, 92, 231, 0.1);
            backdrop-filter: var(--blur);
            border-radius: 15px;
            padding: 1.5rem 1rem;
            min-width: 80px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(108, 92, 231, 0.2);
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-light);
            margin-bottom: 0.3rem;
            animation: count-up 1s ease-out;
        }

        @keyframes count-up {
            from { 
                transform: translateY(20px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Personalized Recommendations Section */
        .recommendations-section {
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            animation: slideInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.5s both;
        }

        .recommendations-container {
            position: relative;
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .section-header h2 {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-text);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-flow 6s ease-in-out infinite;
            margin-bottom: 1rem;
        }

        .section-header p {
            color: var(--text-gray);
            font-size: 1.1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2.5rem;
        }

        .recommendation-card {
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-strong);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(108, 92, 231, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .recommendation-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(108, 92, 231, 0.4);
        }

        .recommendation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(108, 92, 231, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        .recommendation-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink));
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .recommendation-loading {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-gray);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(108, 92, 231, 0.2);
            border-top: 3px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .recommendation-controls {
            text-align: center;
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-refresh-recommendations,
        .btn-customize-preferences {
            background: rgba(108, 92, 231, 0.1);
            backdrop-filter: var(--blur);
            border: 2px solid rgba(108, 92, 231, 0.3);
            color: var(--text-light);
            padding: 1rem 2rem;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-refresh-recommendations:hover,
        .btn-customize-preferences:hover {
            background: rgba(108, 92, 231, 0.2);
            border-color: var(--primary-purple);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.3);
        }

        .recommendation-score {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(0, 255, 0, 0.1);
            color: #00ff88;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        /* Ultra Modern Search Section */
        .search-section {
            background: rgba(26, 29, 58, 0.4);
            backdrop-filter: var(--blur-strong);
            border-radius: 30px;
            padding: 3.5rem;
            margin: 2rem auto;
            max-width: 1100px;
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(108, 92, 231, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: slideInUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
            position: relative;
            overflow: hidden;
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr auto;
            gap: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .search-group {
            position: relative;
        }

        .search-group label {
            display: block;
            margin-bottom: 0.8rem;
            font-weight: 700;
            color: var(--text-light);
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .search-input {
            width: 100%;
            padding: 1.2rem 1.8rem;
            border: 2px solid rgba(108, 92, 231, 0.2);
            border-radius: 20px;
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-medium);
            color: var(--text-light);
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            background: rgba(26, 29, 58, 0.8);
            box-shadow: 
                0 0 30px rgba(108, 92, 231, 0.4),
                inset 0 2px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(-3px) scale(1.02);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        .search-btn {
            padding: 1.2rem 2.5rem;
            background: var(--gradient-primary);
            background-size: 200% 200%;
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 15px 40px rgba(108, 92, 231, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            align-self: end;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: gradient-flow 6s ease-in-out infinite;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.6s ease;
        }

        .search-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 
                0 25px 60px rgba(108, 92, 231, 0.6),
                0 0 40px rgba(253, 121, 168, 0.3);
            background-position: 100% 0;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        /* Results Section */
        .results-section {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-light);
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .toggle-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--primary-purple);
            background: transparent;
            color: var(--primary-purple);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-btn.active,
        .toggle-btn:hover {
            background: var(--primary-purple);
            color: white;
            transform: translateY(-2px);
        }

        /* Content Layout */
        .content-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .content-layout.map-hidden {
            grid-template-columns: 1fr;
        }

        /* Ultra Modern Event Cards */
        .event-card {
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-strong);
            border-radius: 25px;
            padding: 0;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(108, 92, 231, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(108, 92, 231, 0.2);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
        }

        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: all 0.6s ease;
            z-index: -1;
        }

        .event-card:hover {
            transform: translateY(-15px) rotateX(5deg) rotateY(5deg);
            box-shadow: 
                0 40px 80px rgba(0, 0, 0, 0.6),
                0 0 50px rgba(108, 92, 231, 0.4),
                0 0 100px rgba(253, 121, 168, 0.2);
            border-color: var(--primary-cyan);
        }

        .event-card:hover::before {
            opacity: 0.05;
        }

        .event-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 25px 25px 0 0;
            transition: all 0.6s ease;
            filter: brightness(0.9) contrast(1.1);
        }

        .event-card:hover .event-image {
            transform: scale(1.1);
            filter: brightness(1.1) contrast(1.2) saturate(1.3);
        }

        .event-content {
            padding: 2rem;
            position: relative;
        }

        .event-date {
            background: var(--gradient-primary);
            background-size: 200% 200%;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: gradient-flow 4s ease-in-out infinite;
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.3);
        }

        .event-title {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 0.8rem;
            color: var(--text-light);
            line-height: 1.3;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, var(--text-light), var(--primary-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .event-card:hover .event-title {
            text-shadow: 0 0 20px rgba(108, 92, 231, 0.6);
        }

        .event-venue {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 500;
        }

        .event-venue i {
            color: var(--primary-purple);
            font-size: 1.1rem;
        }

        .event-price {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--accent-gold);
            margin-bottom: 1.2rem;
            text-shadow: 0 0 15px rgba(253, 203, 110, 0.4);
        }

        .event-tags {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .event-tag {
            background: rgba(108, 92, 231, 0.15);
            backdrop-filter: var(--blur-light);
            color: var(--primary-cyan);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(108, 92, 231, 0.3);
            transition: all 0.3s ease;
        }

        .event-tag:hover {
            background: rgba(108, 92, 231, 0.3);
            color: var(--text-light);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }

        .event-actions {
            display: flex;
            gap: 1.2rem;
        }

        .btn-primary {
            flex: 1;
            padding: 1rem 1.5rem;
            background: var(--gradient-primary);
            background-size: 200% 200%;
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.3);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: all 0.6s ease;
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(108, 92, 231, 0.5);
            background-position: 100% 0;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-secondary {
            padding: 1rem 1.5rem;
            background: rgba(108, 92, 231, 0.1);
            backdrop-filter: var(--blur-light);
            border: 2px solid var(--primary-purple);
            border-radius: 15px;
            color: var(--primary-purple);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-secondary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: all 0.4s ease;
            z-index: -1;
        }

        .btn-secondary:hover {
            color: white;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.4);
        }

        .btn-secondary:hover::before {
            left: 0;
        }

        /* Ultra Modern Map Container */
        .map-container {
            position: sticky;
            top: 120px;
            height: calc(100vh - 140px);
            background: rgba(26, 29, 58, 0.6);
            backdrop-filter: var(--blur-strong);
            border-radius: 25px;
            overflow: hidden;
            border: 1px solid rgba(108, 92, 231, 0.3);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.6s ease;
        }

        .map-container:hover {
            border-color: var(--primary-cyan);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(108, 92, 231, 0.3);
        }

        .map-header {
            padding: 1.5rem;
            background: rgba(26, 29, 58, 0.8);
            backdrop-filter: var(--blur-medium);
            border-bottom: 1px solid rgba(108, 92, 231, 0.3);
            position: relative;
        }

        .map-header::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--gradient-primary);
            opacity: 0.6;
        }

        .map-title {
            font-weight: 700;
            color: var(--text-light);
            font-size: 1.1rem;
            text-shadow: 0 0 15px rgba(108, 92, 231, 0.4);
        }

        #map {
            height: calc(100% - 80px);
            width: 100%;
            filter: hue-rotate(10deg) contrast(1.1) brightness(0.9);
        }

        /* Ultra Advanced Loading Animation */
        .loading {
            text-align: center;
            padding: 5rem 2rem;
            position: relative;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(108, 92, 231, 0.2);
            border-top: 6px solid transparent;
            border-right: 6px solid var(--primary-pink);
            border-bottom: 6px solid transparent;
            border-left: 6px solid var(--primary-cyan);
            border-radius: 50%;
            animation: spin-gradient 1.5s linear infinite, pulse-size 2s ease-in-out infinite;
            margin: 0 auto 2rem;
            position: relative;
            box-shadow: 0 0 40px rgba(108, 92, 231, 0.3);
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border: 3px solid transparent;
            border-top: 3px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin-gradient 1s linear infinite reverse;
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid transparent;
            border-top: 2px solid var(--accent-gold);
            border-radius: 50%;
            animation: spin-gradient 0.8s linear infinite;
        }

        @keyframes spin-gradient {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse-size {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .loading h3 {
            color: var(--text-light);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease-in-out infinite;
        }

        .loading p {
            color: var(--text-gray);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Enhanced Error Messages */
        .error-message {
            background: rgba(255, 118, 117, 0.1);
            backdrop-filter: var(--blur-medium);
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
            padding: 2rem;
            border-radius: 20px;
            margin: 2rem auto;
            max-width: 600px;
            text-align: center;
            box-shadow: 
                0 20px 40px rgba(255, 118, 117, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            animation: shake 0.5s ease-in-out, fadeIn 0.6s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Ultra Modern Toggle Buttons */
        .toggle-btn {
            padding: 1rem 2rem;
            border: 2px solid var(--primary-purple);
            background: rgba(108, 92, 231, 0.1);
            backdrop-filter: var(--blur-light);
            color: var(--primary-purple);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .toggle-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: all 0.4s ease;
            z-index: -1;
        }

        .toggle-btn.active,
        .toggle-btn:hover {
            color: white;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(108, 92, 231, 0.4);
            border-color: var(--primary-cyan);
        }

        .toggle-btn.active::before,
        .toggle-btn:hover::before {
            left: 0;
        }

        /* Results Section Enhanced */
        .results-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--gradient-text);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(108, 92, 231, 0.3);
            animation: gradient-shift 4s ease-in-out infinite;
        }

        /* Content Layout Enhanced */
        .content-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .content-layout.map-hidden {
            grid-template-columns: 1fr;
        }

        /* Events Grid Enhanced */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 2.5rem;
            padding: 1rem;
        }

        /* Advanced Responsive Design */
        @media (max-width: 1200px) {
            .content-layout {
                grid-template-columns: 1fr;
            }
            
            .map-container {
                position: static;
                height: 500px;
                order: -1;
                margin-bottom: 2rem;
            }
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 3rem;
                line-height: 1.1;
            }
            
            .hero p {
                font-size: 1.2rem;
            }
            
            .global-counter-container {
                flex-direction: column;
                gap: 1.5rem;
            }
            
            .counter-widget {
                min-width: auto;
                padding: 2rem;
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .counter-stats {
                gap: 1rem;
                justify-content: center;
            }
            
            .stat-item {
                min-width: 70px;
                padding: 1rem 0.8rem;
            }
            
            .section-header h2 {
                font-size: 2.2rem;
            }
            
            .recommendations-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .recommendation-controls {
                flex-direction: column;
                gap: 1rem;
            }
            
            .search-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .search-section {
                padding: 2.5rem 1.5rem;
                margin: 1rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .events-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .event-card {
                margin: 0 1rem;
            }
            
            .search-btn {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }
            
            .results-title {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 4rem 1rem 2rem;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .search-section {
                padding: 2rem 1rem;
                border-radius: 20px;
            }
            
            .event-content {
                padding: 1.5rem;
            }
            
            .btn-primary,
            .btn-secondary {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            
            .event-actions {
                flex-direction: column;
                gap: 0.8rem;
            }
        }

        /* Advanced Custom Animations */
        .fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .pulse {
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 0 20px rgba(108, 92, 231, 0);
                transform: scale(1.05);
            }
        }

        /* Floating Particles Animation */
        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--primary-purple);
            border-radius: 50%;
            animation: float-up 8s linear infinite;
            opacity: 0.6;
            box-shadow: 0 0 10px currentColor;
        }

        .particle:nth-child(2n) {
            background: var(--primary-pink);
            animation-duration: 10s;
        }

        .particle:nth-child(3n) {
            background: var(--primary-cyan);
            animation-duration: 12s;
        }

        .particle:nth-child(4n) {
            background: var(--accent-gold);
            animation-duration: 9s;
        }

        @keyframes float-up {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Scroll Indicator */
        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(108, 92, 231, 0.2);
            z-index: 9999;
        }

        .scroll-progress {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.1s ease;
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus States */
        button:focus-visible,
        input:focus-visible,
        a:focus-visible {
            outline: 3px solid var(--primary-cyan);
            outline-offset: 2px;
            box-shadow: 0 0 0 6px rgba(0, 212, 255, 0.2);
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --primary-purple: #9D4EDD;
                --primary-pink: #F72585;
                --text-light: #FFFFFF;
                --dark-bg: #000000;
                --card-bg: #1A1A1A;
            }
        }

        /* Sponsored Events Animations */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .sponsor-badge:hover {
            transform: scale(1.1);
            transition: transform 0.3s ease;
        }

        /* Enhanced Button Styling */
        .btn-shop:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-follow:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        }

        /* Responsive adjustments for small screens */
        @media (max-width: 320px) {
            /* Very small screens - stack main buttons vertically */
            .event-actions > div:first-child {
                flex-direction: column !important;
            }
            
            .event-actions .btn-secondary {
                width: 100% !important;
                height: auto !important;
            }
            
            /* Hide social text on very small screens */
            .social-text {
                display: none !important;
            }
            
            /* Make social buttons more compact */
            .event-actions [style*="grid-template-columns"] {
                grid-template-columns: repeat(5, 1fr) !important;
            }
        }
        
        @media (max-width: 480px) {
            .event-actions {
                padding: 0.5rem;
            }
            
            .btn-shop span,
            .btn-follow span {
                font-size: 0.75rem;
            }
            
            .event-actions > div {
                gap: 0.5rem !important;
            }
            
            /* Hide social text on small screens, show only icons */
            .social-text {
                display: none;
            }
            
            /* Adjust social button grid for mobile */
            .event-actions [style*="grid-template-columns"] {
                grid-template-columns: repeat(auto-fit, minmax(40px, 1fr)) !important;
                gap: 0.3rem !important;
            }
        }
        
        @media (min-width: 481px) and (max-width: 768px) {
            /* Show abbreviated text on medium screens */
            .social-text {
                font-size: 0.7rem;
            }
        }
        
        @media (min-width: 769px) {
            /* Show full text on larger screens */
            .social-text {
                font-size: 0.75rem;
            }
        }

        /* Sidebar Ads - Desktop Only */
        @media (min-width: 1024px) {
            .sidebar-ads {
                display: block !important;
            }
            
            .main-content-grid {
                grid-template-columns: 1fr 300px !important;
            }
        }

        @media (max-width: 1023px) {
            .main-content-grid {
                grid-template-columns: 1fr !important;
            }
            
            .sidebar-ads {
                display: none !important;
            }
        }

        /* Native Ad Styling */
        .native-ad-card {
            transition: all 0.3s ease;
        }

        .native-ad-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(108, 92, 231, 0.3) !important;
        }

        /* Ad Revenue Optimization */
        .ad-banner:hover,
        .sidebar-ad-slot:hover {
            transform: scale(1.02);
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Scroll Indicator -->
    <div class="scroll-indicator">
        <div class="scroll-progress" id="scrollProgress"></div>
    </div>
    
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Floating Particles -->
    <div class="floating-particles" id="floatingParticles"></div>
    
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">EventFinder</div>
            <nav>
                <ul class="nav-links">
                    <li><a href="#home">Home</a></li>
                    <li><a href="#search">Search</a></li>
                    <li><a href="#events">Events</a></li>
                    <li><a href="#map">Map</a></li>
                    <li><a href="#about">About</a></li>
                </ul>
            </nav>
            
            <!-- Language Switcher -->
            <div class="language-switcher">
                <button class="lang-btn active" onclick="switchLanguage('en')" title="English">
                    吼 EN
                </button>
                <button class="lang-btn" onclick="switchLanguage('pl')" title="Polski">
                    叼 PL
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero" id="home">
            <h1>Discover the Best Events</h1>
            <p>Find amazing concerts, shows and events in your area. 
               Thousands of events are waiting for you!</p>
        </section>

        <!-- Global Events Counter -->
        <section class="global-counter-section">
            <div class="global-counter-container">
                <div class="counter-widget">
                    <div class="counter-icon"></div>
                    <div class="counter-content">
                        <div class="counter-label">Events worldwide</div>
                        <div class="counter-number" id="globalEventCounter">
                            <span class="counter-value">0</span>
                        </div>
                        <div class="counter-sublabel">available now</div>
                    </div>
                    <div class="counter-pulse"></div>
                </div>
                <div class="counter-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="countriesCount">0</div>
                        <div class="stat-label">countries</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="citiesCount">0</div>
                        <div class="stat-label">cities</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="todayCount">0</div>
                        <div class="stat-label">today</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Personalized Recommendations -->
        <section class="recommendations-section">
            <div class="recommendations-container">
                <div class="section-header">
                    <h2> Recommended for You</h2>
                    <p>Based on your preferences and popular events</p>
                </div>
                
                <div class="recommendations-grid" id="recommendationsGrid">
                    <!-- Recommendations will be loaded here -->
                    <div class="recommendation-loading">
                        <div class="loading-spinner"></div>
                        <p>Finding the best events for you...</p>
                    </div>
                </div>
                
                <div class="recommendation-controls">
                    <button class="btn-refresh-recommendations" onclick="refreshRecommendations()">
                        <i class="fas fa-sync-alt"></i> Refresh Recommendations
                    </button>
                    <button class="btn-customize-preferences" onclick="showPreferences()">
                        <i class="fas fa-cog"></i> Customize Preferences
                    </button>
                </div>
            </div>
        </section>

        <!-- Search Section -->
        <section class="search-section" id="search">
            <!-- Strategic Ad #1: Above Search (Highest CPM Zone) -->
            <div class="premium-ad-top" style="margin-bottom: 2rem; text-align: center; padding: 1.5rem; background: rgba(26, 29, 58, 0.4); border-radius: 15px; border: 1px dashed rgba(108, 92, 231, 0.3);">
                <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 1rem;"> Miejsce Premium - CPM: 8-15 z/1000</p>
                <!-- REAL ADSENSE CODE GOES HERE -->
                <div style="background: linear-gradient(135deg, rgba(108, 92, 231, 0.1), rgba(255, 105, 180, 0.1)); padding: 2rem; border-radius: 12px;">
                    <div style="color: var(--text-light); font-size: 1.1rem;"> Your Ad Here</div>
                    <div style="color: var(--text-gray); font-size: 0.9rem;">Highest CPM - first thing users see</div>
                </div>
            </div>
            
            <div class="search-grid">
                <div class="search-group">
                    <label for="keyword"> Keyword</label>
                    <input type="text" id="keyword" class="search-input" 
                           placeholder="e.g. concert, theater, comedy...">
                </div>
                <div class="search-group">
                    <label for="country"> Country</label>
                    <select id="country" class="search-input">
                        <option value="" selected> Worldwide</option>
                        <option value="PL">叼 Poland</option>
                        <option value="US">吼 USA</option>
                        <option value="GB"> United Kingdom</option>
                        <option value="DE"> Germany</option>
                        <option value="FR"> France</option>
                        <option value="IT"> Italy</option>
                        <option value="ES"> Spain</option>
                        <option value="NL">仇 Netherlands</option>
                        <option value="BE">ю Belgium</option>
                        <option value="CH"> Switzerland</option>
                        <option value="AT"> Austria</option>
                        <option value="CZ"> Czech Republic</option>
                        <option value="SK">葛 Slovakia</option>
                        <option value="HU"> Hungary</option>
                        <option value="SE">葛 Sweden</option>
                        <option value="NO">仇 Norway</option>
                        <option value="DK"> Denmark</option>
                        <option value="FI"> Finland</option>
                        <option value="CA"> Canada</option>
                        <option value="AU"> Australia</option>
                        <option value="NZ">仇 New Zealand</option>
                        <option value="JP"> Japan</option>
                        <option value="KR">梆 South Korea</option>
                        <option value="SG">葛 Singapore</option>
                        <option value="MX">拆 Mexico</option>
                        <option value="BR">ю Brazil</option>
                        <option value="AR"> Argentina</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="city"> City</label>
                    <input type="text" id="city" class="search-input" 
                           placeholder="e.g. Warsaw, London, New York...">
                </div>
                <div class="search-group">
                    <label for="date"> Date</label>
                    <input type="date" id="date" class="search-input">
                </div>
                <button class="search-btn" onclick="searchEvents()">
                    <i class="fas fa-search"></i> Search Events
                </button>
            </div>
            
            <!-- Premium Features -->
            <div class="premium-section" style="margin-top: 2rem; background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(255, 105, 180, 0.15)); border-radius: 15px; border: 1px solid rgba(157, 78, 221, 0.3); padding: 2rem; text-align: center;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="font-size: 3rem;"></div>
                    <h3 style="color: var(--text-light); margin: 0; font-size: 1.5rem;">EventFinder Premium</h3>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(157, 78, 221, 0.2);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                        <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">SMS Notifications</h4>
                        <p style="color: var(--text-gray); font-size: 0.9rem;">Get SMS alerts about new events from your favorite artists</p>
                    </div>
                    
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(157, 78, 221, 0.2);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                        <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">Calendar Sync</h4>
                        <p style="color: var(--text-gray); font-size: 0.9rem;">Automatically add events to Google/Apple Calendar</p>
                    </div>
                    
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 1.5rem; border-radius: 12px; border: 1px solid rgba(157, 78, 221, 0.2);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">猸</div>
                        <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">Unlimited Favorites</h4>
                        <p style="color: var(--text-gray); font-size: 0.9rem;">Save unlimited favorite events and artists</p>
                    </div>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <div style="font-size: 2rem; color: var(--primary-pink); font-weight: bold;">only $19.99/month</div>
                    <div style="color: var(--text-gray); font-size: 0.9rem;">cancel anytime</div>
                </div>
                
                <button onclick="upgradeToPremium()" 
                        style="background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink)); 
                               border: none; padding: 1rem 2rem; border-radius: 12px; 
                               color: white; font-weight: 600; font-size: 1.1rem; cursor: pointer; 
                               transition: all 0.3s ease; box-shadow: 0 8px 30px rgba(157, 78, 221, 0.3);">
                     Upgrade to Premium
                </button>
            </div>
            
            <!-- Newsletter Signup -->
            <div class="newsletter-section" style="margin-top: 2rem; text-align: center; padding: 1.5rem; background: rgba(108, 92, 231, 0.1); border-radius: 15px; border: 1px solid rgba(108, 92, 231, 0.2);">
                <h4 style="color: var(--text-light); margin-bottom: 0.5rem;"> Don't miss the best events!</h4>
                <p style="color: var(--text-gray); margin-bottom: 1rem; font-size: 0.9rem;">Get notifications about new concerts and events in your area</p>
                <div style="display: flex; gap: 1rem; max-width: 400px; margin: 0 auto;">
                    <input type="email" id="newsletterEmail" placeholder="Your email..." 
                           style="flex: 1; padding: 0.8rem; border: 1px solid rgba(108, 92, 231, 0.3); border-radius: 10px; background: rgba(26, 29, 58, 0.6); color: white;">
                    <button onclick="subscribeNewsletter()" 
                            style="padding: 0.8rem 1.5rem; background: var(--gradient-primary); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer;">
                        Subscribe
                    </button>
                </div>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section" id="events">
            <div class="results-header">
                <h2 class="results-title">Search Results</h2>
                <div class="view-toggle">
                    <button class="toggle-btn active" onclick="toggleView('grid')">
                        <i class="fas fa-th-large"></i> Grid
                    </button>
                    <button class="toggle-btn" onclick="toggleView('map')">
                        <i class="fas fa-map"></i> Map
                    </button>
                </div>
            </div>

            <div class="content-layout" id="contentLayout">
                <!-- Ad Space - Top Banner -->
                <div class="ad-banner" style="grid-column: 1 / -1; margin-bottom: 2rem; text-align: center; padding: 1rem; background: rgba(26, 29, 58, 0.4); border-radius: 15px; border: 1px dashed rgba(108, 92, 231, 0.3);">
                    <!-- Google AdSense Banner -->
                    <p style="color: var(--text-muted); font-size: 0.8rem;">Banner Ad - CPM: 5-10 z/1000</p>
                    <!-- AdSense Banner Ad - LIVE -->
                    <ins class="adsbygoogle"
                         style="display:block"
                         data-ad-client="ca-pub-9110227480064306"
                         data-ad-slot="1213276832"
                         data-ad-format="auto"
                         data-full-width-responsive="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                    <div style="background: rgba(108, 92, 231, 0.1); padding: 1.5rem; border-radius: 12px;">
                        <div style="color: var(--text-light);"> Banner reklamowy 728x90 lub responsywny</div>
                    </div>
                </div>
                
                <!-- Main Content Area with Sidebar -->
                <div style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem; grid-column: 1 / -1;" class="main-content-grid">
                    <!-- Events Grid -->
                    <div class="events-container">
                        <div class="events-grid" id="eventsGrid">
                            <!-- Event cards will be inserted here -->
                        </div>
                    </div>
                    
                    <!-- Sidebar with Ads (Desktop only) -->
                    <div class="sidebar-ads" style="display: none;">
                        <!-- Sticky Sidebar Ad #1 -->
                        <div class="sidebar-ad-slot" style="position: sticky; top: 100px; margin-bottom: 2rem; padding: 1.5rem; background: rgba(26, 29, 58, 0.4); border-radius: 15px; border: 1px dashed rgba(108, 92, 231, 0.3); text-align: center;">
                            <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 1rem;">Sidebar Ad - CPM: 4-8 z/1000</p>
                            <!-- 
                            REAL ADSENSE:
                            <ins class="adsbygoogle"
                                 style="display:block"
                                 data-ad-client="ca-pub-YOUR-PUBLISHER-ID"
                                 data-ad-slot="SIDEBAR-SLOT-1"
                                 data-ad-format="rectangle"></ins>
                            -->
                            <div style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 12px; min-height: 250px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;"></div>
                                <div style="color: var(--text-light); font-size: 0.9rem; text-align: center;">
                                    Rectangle Ad<br>300x250
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sticky Sidebar Ad #2 -->
                        <div class="sidebar-ad-slot" style="position: sticky; top: 400px; padding: 1.5rem; background: rgba(26, 29, 58, 0.4); border-radius: 15px; border: 1px dashed rgba(108, 92, 231, 0.3); text-align: center;">
                            <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 1rem;">Sidebar Ad #2</p>
                            <div style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 12px; min-height: 200px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                <div style="font-size: 1.5rem; margin-bottom: 0.5rem;"></div>
                                <div style="color: var(--text-light); font-size: 0.9rem; text-align: center;">
                                    Square Ad<br>250x250
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Events Grid (Legacy - will be hidden) -->
                <div class="events-container" style="display: none;">
                    <div class="events-grid" id="eventsGridOld">
                        <!-- Loading state -->
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>Finding the best events for you...</p>
                        </div>
                    </div>
                </div>

                <!-- Map Container -->
                <div class="map-container" id="mapContainer">
                    <div class="map-header">
                        <h3 class="map-title">猴 Events Map</h3>
                    </div>
                    <div id="map"></div>
                    
                    <!-- Ad Space - Sidebar -->
                    <div class="ad-sidebar" style="padding: 1rem; background: rgba(26, 29, 58, 0.6); border-top: 1px solid rgba(108, 92, 231, 0.2); text-align: center;">
                        <p style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 0.5rem;">Sponsored</p>
                        <!-- Place for affiliate links or ads -->
                        <div style="padding: 1rem; border: 1px dashed rgba(108, 92, 231, 0.3); border-radius: 10px;">
                            <p style="color: var(--text-gray); font-size: 0.9rem;"> Buy music gear on Amazon</p>
                            <!-- Amazon affiliate link would go here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="about-section" style="padding: 4rem 2rem; background: linear-gradient(135deg, rgba(26, 29, 58, 0.9), rgba(108, 92, 231, 0.1)); margin-top: 2rem;">
            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                <div class="about-content" style="text-align: center; margin-bottom: 3rem;">
                    <h2 style="font-size: 2.5rem; margin-bottom: 1rem; color: var(--primary-gradient); background: linear-gradient(135deg, #6C5CE7, #FD79A8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                         About EventFinder
                    </h2>
                    <p style="font-size: 1.2rem; color: var(--text-light); line-height: 1.6; max-width: 800px; margin: 0 auto;">
                        Your ultimate destination for discovering amazing events and concerts worldwide. We connect you with unforgettable experiences across the globe.
                    </p>
                </div>

                <div class="features-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Global Events</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">Access to over 125,000+ events worldwide through Ticketmaster's Discovery API. From concerts to theater, sports to festivals.</p>
                    </div>

                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">猴</div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Interactive Map</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">Visualize events on an interactive world map. Discover what's happening near you or explore events in your next travel destination.</p>
                    </div>

                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">猸</div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Smart Recommendations</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">AI-powered recommendations based on your preferences, location, and browsing history. Never miss an event you'd love.</p>
                    </div>

                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Premium Features</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">SMS notifications, calendar sync, unlimited favorites, and priority customer support for just $19.99/month.</p>
                    </div>

                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Multilingual</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">Available in English and Polish with more languages coming soon. Experience EventFinder in your preferred language.</p>
                    </div>

                    <div class="feature-card" style="background: rgba(108, 92, 231, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(108, 92, 231, 0.2); backdrop-filter: blur(10px);">
                        <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.3rem;">Mobile First</h3>
                        <p style="color: var(--text-gray); line-height: 1.5;">Fully responsive design that works perfectly on all devices. Find and book events on the go with our mobile-optimized interface.</p>
                    </div>
                </div>

                <div class="stats-section" style="background: rgba(253, 121, 168, 0.1); padding: 2rem; border-radius: 20px; border: 1px solid rgba(253, 121, 168, 0.2); text-align: center;">
                    <h3 style="color: var(--text-light); margin-bottom: 2rem; font-size: 1.5rem;">Platform Statistics</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem;">
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; color: #6C5CE7; margin-bottom: 0.5rem;">125K+</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Events Available</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; color: #FD79A8; margin-bottom: 0.5rem;">45+</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Countries</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; color: #00CEC9; margin-bottom: 0.5rem;">1000+</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Cities</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; color: #A29BFE; margin-bottom: 0.5rem;">24/7</div>
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Live Updates</div>
                        </div>
                    </div>
                </div>

                <div class="contact-section" style="text-align: center; margin-top: 3rem;">
                    <h3 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.5rem;">Get in Touch</h3>
                    <p style="color: var(--text-gray); margin-bottom: 2rem;">Have questions or suggestions? We'd love to hear from you!</p>
                    <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
                        <a href="mailto:contact@eventfinder.fun" style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--text-light); text-decoration: none; padding: 0.8rem 1.5rem; background: rgba(108, 92, 231, 0.2); border-radius: 10px; border: 1px solid rgba(108, 92, 231, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(108, 92, 231, 0.3)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(108, 92, 231, 0.2)'; this.style.transform='translateY(0)'">
                             contact@eventfinder.fun
                        </a>
                        <a href="https://twitter.com/eventfinder" style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--text-light); text-decoration: none; padding: 0.8rem 1.5rem; background: rgba(108, 92, 231, 0.2); border-radius: 10px; border: 1px solid rgba(108, 92, 231, 0.3); transition: all 0.3s ease;" onmouseover="this.style.background='rgba(108, 92, 231, 0.3)'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='rgba(108, 92, 231, 0.2)'; this.style.transform='translateY(0)'">
                             Follow us on Twitter
                        </a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Ticketmaster API Configuration
        const TICKETMASTER_API = {
            key: 'Da7rEZhADVCfrV7GW3AUvyDGedmmcmKG',
            baseUrl: 'https://app.ticketmaster.com/discovery/v2'
        };

        // Global variables
        let map;
        let eventsData = [];
        let markers = [];

        // Initialize map
        function initMap() {
            // Start with global view - world centered
            map = L.map('map').setView([20, 0], 2); // Global center view
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '漏 OpenStreetMap contributors'
            }).addTo(map);

            // Custom marker styling with enhanced global colors
            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: '<div style="background: linear-gradient(135deg, #6C5CE7, #FD79A8); width: 25px; height: 25px; border-radius: 50%; border: 3px solid white; box-shadow: 0 3px 10px rgba(0,0,0,0.3);"></div>',
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            });
        }

        // Enhanced event search with better error handling and debugging
        async function searchEvents() {
            const keyword = document.getElementById('keyword').value || '';
            const country = document.getElementById('country').value || '';
            const city = document.getElementById('city').value || '';
            const date = document.getElementById('date').value || '';
            
            showLoading();
            
            try {
                let eventsData = [];
                
                if (!country && !city && !keyword) {
                    // For global search without filters, get events from multiple regions
                    console.log(' Performing global search across multiple regions...');
                    
                    // Show special loading message for global search
                    document.getElementById('eventsGrid').innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <p style="margin-top: 1rem; color: var(--text-light);">
                                 ${currentLanguage === 'pl' ? 
                                    'Szukamy event贸w na caym wiecie...' : 
                                    'Searching for events worldwide...'}
                            </p>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-top: 0.5rem;">
                                ${currentLanguage === 'pl' ? 
                                    'Sprawdzamy eventy w USA, Europie, Azji i innych regionach' : 
                                    'Checking events in USA, Europe, Asia and other regions'}
                            </p>
                        </div>
                    `;
                    
                    eventsData = await searchGlobalEvents();
                } else {
                    // Regular targeted search
                    const url = buildApiUrl(keyword, country, city, date);
                    console.log(' Searching with URL:', url);
                    console.log(' Selected country:', country);
                    
                    const response = await fetch(url);
                    console.log(' Response status:', response.status);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    console.log(' Full API Response:', data);
                    
                    if (data._embedded && data._embedded.events) {
                        eventsData = data._embedded.events;
                    }
                }
                
                if (eventsData && eventsData.length > 0) {
                    console.log(' Found events:', eventsData.length);
                    
                    // Store globally for other functions
                    window.eventsData = eventsData;
                    
                    // Log first event to see data structure
                    if (eventsData.length > 0) {
                        console.log(' First event structure:', eventsData[0]);
                        console.log(' Price ranges in first event:', eventsData[0].priceRanges);
                        console.log(' First event venue:', eventsData[0]._embedded?.venues?.[0]);
                    }
                    
                    displayEvents(eventsData);
                    updateMap(eventsData);
                    
                    // Enhanced country focusing for European countries
                    if (country && markers.length === 0) {
                        console.log(`猴 No markers found for ${country}, focusing map on country`);
                        focusMapOnCountry(country);
                    } else if (markers.length > 0) {
                        console.log(` Added ${markers.length} markers to map`);
                    }
                    
                    const countryName = getCountryName(country);
                    const location = countryName || (currentLanguage === 'pl' ? 'na caym wiecie' : 'worldwide');
                    document.querySelector('.results-title').textContent = 
                        currentLanguage === 'pl' ? 
                        `Znaleziono ${eventsData.length} event贸w ${location}` :
                        `Found ${eventsData.length} events ${location}`;
                } else {
                    console.log(' No events found in response');
                    showNoResults();
                }
                
            } catch (error) {
                console.error(' Error searching events:', error);
                const errorMsg = currentLanguage === 'pl' ? 
                    'Nie udao si pobra danych. Spr贸buj ponownie.' :
                    'Failed to fetch data. Please try again.';
                showError(errorMsg);
            }
        }

        // Search for events globally across multiple regions
        async function searchGlobalEvents() {
            const regions = ['US', 'GB', 'DE', 'FR', 'IT', 'ES', 'CA', 'AU', 'PL', 'NL'];
            const allEvents = [];
            
            console.log(' Searching across regions:', regions);
            
            // Get 5-10 events from each region
            const promises = regions.map(async (countryCode) => {
                try {
                    const params = new URLSearchParams({
                        apikey: TICKETMASTER_API.key,
                        size: 5,
                        countryCode: countryCode,
                        sort: 'date,asc',
                        includeTBA: 'no',
                        includeTBD: 'no',
                        includeTest: 'no'
                    });
                    
                    const url = `${TICKETMASTER_API.baseUrl}/events?${params}`;
                    const response = await fetch(url);
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data._embedded && data._embedded.events) {
                            console.log(` Found ${data._embedded.events.length} events in ${countryCode}`);
                            return data._embedded.events;
                        }
                    } else {
                        console.log(`锔 No response from ${countryCode}: ${response.status}`);
                    }
                    return [];
                } catch (error) {
                    console.error(` Error fetching events for ${countryCode}:`, error);
                    return [];
                }
            });
            
            try {
                const results = await Promise.allSettled(promises);
                
                // Combine results from successful requests
                results.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value) {
                        allEvents.push(...result.value);
                    } else {
                        console.log(`锔 Failed request for ${regions[index]}`);
                    }
                });
                
                // Shuffle array to mix regions
                for (let i = allEvents.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allEvents[i], allEvents[j]] = [allEvents[j], allEvents[i]];
                }
                
                console.log(` Total global events found: ${allEvents.length}`);
                return allEvents.slice(0, 50); // Limit to 50 events
            } catch (error) {
                console.error(' Error in global search:', error);
                return [];
            }
        }

        // Build API URL with enhanced parameters
        function buildApiUrl(keyword, country, city, date) {
            const params = new URLSearchParams({
                apikey: TICKETMASTER_API.key,
                size: 50,
                includeTBA: 'no',
                includeTBD: 'no',
                includeTest: 'no'
            });
            
            // Add country code if selected (empty means worldwide)
            if (country) {
                params.append('countryCode', country);
                params.append('sort', 'date,asc');
            } else {
                // For worldwide searches, use relevance sorting and add multiple markets
                params.append('sort', 'relevance,desc');
                // Add a random page to get different results each time
                const randomPage = Math.floor(Math.random() * 5); // 0-4
                params.append('page', randomPage.toString());
            }
            
            if (keyword) params.append('keyword', keyword);
            if (city) params.append('city', city);
            if (date) params.append('localStartDateTime', date + 'T00:00:00');
            
            return `${TICKETMASTER_API.baseUrl}/events?${params}`;
        }

        // Get country name from code
        function getCountryName(countryCode) {
            const countries = {
                'PL': 'in Poland',
                'US': 'in USA',
                'GB': 'in United Kingdom',
                'DE': 'in Germany',
                'FR': 'in France',
                'IT': 'in Italy',
                'ES': 'in Spain',
                'NL': 'in Netherlands',
                'BE': 'in Belgium',
                'CH': 'in Switzerland',
                'AT': 'in Austria',
                'CZ': 'in Czech Republic',
                'SK': 'in Slovakia',
                'HU': 'in Hungary',
                'SE': 'in Sweden',
                'NO': 'in Norway',
                'DK': 'in Denmark',
                'FI': 'in Finland',
                'CA': 'in Canada',
                'AU': 'in Australia',
                'NZ': 'in New Zealand',
                'JP': 'in Japan',
                'KR': 'in South Korea',
                'SG': 'in Singapore',
                'MX': 'in Mexico',
                'BR': 'in Brazil',
                'AR': 'in Argentina'
            };
            return countries[countryCode] || '';
        }

        // Display events
        function displayEvents(events) {
            const grid = document.getElementById('eventsGrid');
            
            if (events.length === 0) {
                showNoResults();
                return;
            }
            
            // Insert ads between events for monetization
            const eventsWithAds = [];
            events.forEach((event, index) => {
                eventsWithAds.push(createEventCard(event));
                
                // Insert ad every 3 events (optimal for CPM without annoying users)
                if ((index + 1) % 3 === 0 && index < events.length - 1) {
                    eventsWithAds.push(createNativeAd(index + 1));
                }
            });
            
            grid.innerHTML = eventsWithAds.join('');
            
            // Add fade-in animation to cards
            const cards = grid.querySelectorAll('.event-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('fade-in');
            });
        }

        // Create native ad card that looks like event card
        function createNativeAd(position) {
            return `
                <div class="event-card native-ad-card" style="border: 2px dashed rgba(108, 92, 231, 0.3); background: rgba(26, 29, 58, 0.6);">
                    <div style="padding: 2rem; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;"></div>
                        <h3 style="color: var(--primary-purple); margin-bottom: 1rem;">Native Ad Spot #${Math.ceil(position/3)}</h3>
                        <p style="color: var(--text-gray); margin-bottom: 1rem; font-size: 0.9rem;">
                            CPM: 6-12 z/1000 wywietle<br>
                            Native ads maj 3x wy偶szy CTR
                        </p>
                        <!-- 
                        REPLACE WITH REAL ADSENSE:
                        <ins class="adsbygoogle"
                             style="display:block; text-align:center;"
                             data-ad-layout="in-article"
                             data-ad-format="fluid"
                             data-ad-client="ca-pub-YOUR-PUBLISHER-ID"
                             data-ad-slot="NATIVE-AD-SLOT"></ins>
                        -->
                        <div style="background: rgba(108, 92, 231, 0.1); padding: 1.5rem; border-radius: 12px;">
                            <div style="color: var(--text-light); font-weight: 600;"> Twoja reklama tutaj</div>
                            <div style="color: var(--text-gray); font-size: 0.85rem; margin-top: 0.5rem;">
                                Format native - wyglda jak naturalny content
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create event card HTML
        function createEventCard(event) {
            // Check if event is sponsored
            const isSponsored = checkIfSponsored(event);
            const sponsorBadge = isSponsored ? `
                <div class="sponsor-badge" style="
                    position: absolute; 
                    top: 10px; 
                    right: 10px; 
                    background: linear-gradient(135deg, #FFD700, #FFA500); 
                    color: #000; 
                    padding: 5px 12px; 
                    border-radius: 20px; 
                    font-size: 0.8rem; 
                    font-weight: bold;
                    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
                    animation: pulse 2s infinite;
                ">
                    猸 SPONSOROWANE
                </div>
            ` : '';
            
            const date = new Date(event.dates.start.localDate).toLocaleDateString('pl-PL', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            const time = event.dates.start.localTime || '';
            const venue = event._embedded?.venues?.[0]?.name || 'Venue TBA';
            const city = event._embedded?.venues?.[0]?.city?.name || '';
            const image = event.images?.[0]?.url || 'https://via.placeholder.com/400x200/6C5CE7/FFFFFF?text=Event';
            
            // Enhanced price handling with more detailed checking
            let priceInfo = 'Check event page';
            
            if (event.priceRanges && event.priceRanges.length > 0) {
                const price = event.priceRanges[0];
                if (price.min && price.max && price.currency) {
                    if (price.min === price.max) {
                        priceInfo = `${price.min} ${price.currency}`;
                    } else {
                        priceInfo = `${price.min} - ${price.max} ${price.currency}`;
                    }
                } else if (price.min && price.currency) {
                    priceInfo = `from ${price.min} ${price.currency}`;
                } else if (price.max && price.currency) {
                    priceInfo = `up to ${price.max} ${price.currency}`;
                }
            } else if (event.accessibility && event.accessibility.info && 
                       event.accessibility.info.toLowerCase().includes('free')) {
                priceInfo = 'Free';
            } else if (event.info) {
                // Check event info for price indicators
                const info = event.info.toLowerCase();
                if (info.includes('free')) {
                    priceInfo = 'Free';
                } else if (info.includes('sold out')) {
                    priceInfo = 'Sold Out';
                }
            }
                
            const category = event.classifications?.[0]?.segment?.name || 'Event';
            const genre = event.classifications?.[0]?.genre?.name || '';
            
            // Add debug logging to see what data we get
            console.log('Event price data:', {
                name: event.name,
                priceRanges: event.priceRanges,
                accessibility: event.accessibility,
                info: event.info,
                finalPrice: priceInfo
            });
            
            return `
                <div class="event-card" onclick="openEventDetails('${event.id}')" ${isSponsored ? 'style="border: 2px solid #FFD700; box-shadow: 0 8px 30px rgba(255, 215, 0, 0.2); position: relative;"' : 'style="position: relative;"'}>
                    ${sponsorBadge}
                    <img src="${image}" alt="${event.name}" class="event-image" 
                         onerror="this.src='https://via.placeholder.com/400x200/6C5CE7/FFFFFF?text=Event'">
                    <div class="event-content">
                        <div class="event-date">
                             ${date} ${time}
                        </div>
                        <h3 class="event-title">${event.name}</h3>
                        <div class="event-venue">
                            <i class="fas fa-map-marker-alt"></i>
                            ${venue}${city ? `, ${city}` : ''}
                        </div>
                        <div class="event-price"> ${priceInfo}</div>
                        ${event.priceRanges && event.priceRanges.length > 0 ? 
                            `<div class="price-note" style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                                 Prices may vary by seating
                            </div>` : 
                            `<div class="price-note" style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                                 Click "Buy Tickets" to check current price
                            </div>`
                        }
                        <div class="event-tags">
                            <span class="event-tag">${category}</span>
                            ${genre ? `<span class="event-tag">${genre}</span>` : ''}
                        </div>
                        <div class="event-actions">
                            <!-- Main actions row - Buy Tickets and Favorite -->
                            <div style="display: flex; gap: 0.8rem; margin-bottom: 0.8rem;">
                                <button class="btn-primary" onclick="event.stopPropagation(); buyTickets('${event.url}')" 
                                        style="flex: 1; padding: 0.8rem 1.2rem; font-size: 0.9rem; font-weight: 600; min-width: 0;">
                                     <span class="btn-text-tickets" style="white-space: nowrap;">Buy Tickets</span>
                                </button>
                                <button class="btn-secondary" onclick="event.stopPropagation(); addToFavorites('${event.id}')" 
                                        style="padding: 0.8rem; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                    わ
                                </button>
                            </div>
                            
                            <!-- Secondary actions row - Merch and Follow -->
                            <div style="display: flex; gap: 0.8rem; margin-bottom: 0.8rem;">
                                <button class="btn-shop" onclick="event.stopPropagation(); showMerchandise('${event.name}', '${event._embedded?.attractions?.[0]?.name || event.name}')" 
                                        style="flex: 1; background: linear-gradient(135deg, #e74c3c, #c0392b); border: none; padding: 0.7rem 0.8rem; border-radius: 8px; color: white; font-size: 0.85rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.3rem; min-width: 0;">
                                     <span class="btn-text-merch" style="white-space: nowrap;">Merch</span>
                                </button>
                                <button class="btn-follow" onclick="event.stopPropagation(); followArtist('${event._embedded?.attractions?.[0]?.name || event.name}', '${event._embedded?.attractions?.[0]?.id || event.id}')" 
                                        style="flex: 1; background: linear-gradient(135deg, #f39c12, #e67e22); border: none; padding: 0.7rem 0.8rem; border-radius: 8px; color: white; font-size: 0.85rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.3rem; min-width: 0;">
                                     <span class="btn-text-follow" style="white-space: nowrap;">Follow</span>
                                </button>
                            </div>
                            
                            <!-- Social Sharing Row - Responsive Grid -->
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(50px, 1fr)); gap: 0.5rem; margin-top: 0.5rem;">
                                <button class="btn-share-facebook" onclick="event.stopPropagation(); shareToFacebook('${event.name}', '${event.url}', '${event.images?.[0]?.url || ''}')" 
                                        style="background: #1877f2; border: none; padding: 0.6rem 0.4rem; border-radius: 8px; color: white; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.2rem;">
                                     <span class="social-text">FB</span>
                                </button>
                                <button class="btn-share-twitter" onclick="event.stopPropagation(); shareToTwitter('${event.name}', '${event.url}')" 
                                        style="background: #1da1f2; border: none; padding: 0.6rem 0.4rem; border-radius: 8px; color: white; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.2rem;">
                                     <span class="social-text">X</span>
                                </button>
                                <button class="btn-share-instagram" onclick="event.stopPropagation(); shareToInstagram('${event.name}', '${event.images?.[0]?.url || ''}')" 
                                        style="background: linear-gradient(135deg, #f58529, #dd2a7b, #8134af); border: none; padding: 0.6rem 0.4rem; border-radius: 8px; color: white; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.2rem;">
                                     <span class="social-text">IG</span>
                                </button>
                                <button class="btn-share-whatsapp" onclick="event.stopPropagation(); shareToWhatsApp('${event.name}', '${event.url}')" 
                                        style="background: #25d366; border: none; padding: 0.6rem 0.4rem; border-radius: 8px; color: white; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.2rem;">
                                     <span class="social-text">WA</span>
                                </button>
                                <button class="btn-copy-link" onclick="event.stopPropagation(); copyEventLink('${event.url}', '${event.name}')" 
                                        style="background: rgba(108, 92, 231, 0.2); border: 1px solid var(--primary-purple); padding: 0.6rem 0.4rem; border-radius: 8px; color: var(--primary-purple); font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 0.2rem;">
                                     <span class="social-text">Link</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Reviews Section -->
                        <div class="event-reviews" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(108, 92, 231, 0.2);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <div style="color: var(--text-gray); font-size: 0.9rem;">猸 User Ratings</div>
                                <button onclick="event.stopPropagation(); showReviews('${event.id}', '${event.name}')" 
                                        style="background: rgba(108, 92, 231, 0.2); border: none; padding: 0.3rem 0.8rem; border-radius: 15px; color: var(--primary-purple); font-size: 0.8rem; cursor: pointer;">
                                    View All
                                </button>
                            </div>
                            <div id="reviews-${event.id}" style="display: flex; gap: 0.5rem; font-size: 0.8rem; color: var(--text-gray);">
                                ${generateSampleReviews()}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update map with events - Enhanced Global Version
        function updateMap(events) {
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            if (!events || events.length === 0) {
                // Reset to global view if no events
                map.setView([20, 0], 2);
                console.log('猴 No events to display, resetting to global view');
                return;
            }
            
            let validEvents = 0;
            
            events.forEach((event, index) => {
                const venue = event._embedded?.venues?.[0];
                console.log(`锔 Event ${index + 1} venue:`, venue);
                
                if (venue?.location) {
                    const lat = parseFloat(venue.location.latitude);
                    const lng = parseFloat(venue.location.longitude);
                    
                    console.log(` Event ${index + 1} coordinates:`, { lat, lng, venue: venue.name });
                    
                    if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                        validEvents++;
                        
                        // Enhanced marker with country flag detection
                        const countryCode = venue.country?.countryCode || venue.address?.countryCode || 'XX';
                        const countryFlag = getCountryFlag(countryCode);
                        
                        console.log(` Adding marker for ${venue.name} in ${countryCode} at [${lat}, ${lng}]`);
                        
                        const marker = L.marker([lat, lng]).addTo(map);
                        
                        const popupContent = `
                            <div style="max-width: 250px; font-family: 'Poppins', sans-serif;">
                                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                    <span style="font-size: 1.2rem; margin-right: 8px;">${countryFlag}</span>
                                    <h4 style="margin: 0; color: #6C5CE7; font-size: 0.95rem; line-height: 1.2;">${event.name}</h4>
                                </div>
                                <p style="margin: 5px 0; color: #666; font-size: 0.85rem;"> <strong>${venue.name}</strong></p>
                                <p style="margin: 5px 0; color: #666; font-size: 0.85rem;">锔 ${venue.city?.name || 'City TBA'}, ${venue.country?.name || countryCode}</p>
                                <p style="margin: 5px 0; color: #666; font-size: 0.85rem;"> ${new Date(event.dates?.start?.localDate || Date.now()).toLocaleDateString(currentLanguage === 'pl' ? 'pl-PL' : 'en-US')}</p>
                                
                                ${event.priceRanges?.[0] ? 
                                    `<p style="margin: 5px 0; color: #27ae60; font-weight: 600; font-size: 0.85rem;"> from ${event.priceRanges[0].min} ${event.priceRanges[0].currency}</p>` : 
                                    `<p style="margin: 5px 0; color: #3498db; font-size: 0.85rem;"> ${currentLanguage === 'pl' ? 'Sprawd藕 cen bilet贸w' : 'Check pricing details'}</p>`
                                }
                                
                                <button onclick="openEventDetails('${event.id}')" 
                                        style="background: linear-gradient(135deg, #6C5CE7, #FD79A8); 
                                               border: none; color: white; padding: 8px 15px; 
                                               border-radius: 8px; cursor: pointer; margin-top: 10px;
                                               font-size: 0.8rem; font-weight: 600; width: 100%;">
                                     ${currentLanguage === 'pl' ? 'Zobacz szczeg贸y' : 'View Details'}
                                </button>
                            </div>
                        `;
                        
                        marker.bindPopup(popupContent);
                        markers.push(marker);
                    } else {
                        console.log(` Invalid coordinates for event ${index + 1}:`, { lat, lng });
                    }
                } else {
                    console.log(` No location data for event ${index + 1}:`, event.name);
                }
            });
            
            console.log(` Map update summary: ${validEvents} valid events out of ${events.length} total`);
            
            // Smart map fitting based on events distribution
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                const bounds = group.getBounds();
                
                if (markers.length === 1) {
                    // Single event - zoom to city level
                    map.setView(markers[0].getLatLng(), 12);
                    console.log(' Single event - zoomed to city level');
                } else if (isNearbyEventsCluster(bounds)) {
                    // Events are close together - city/region view
                    map.fitBounds(bounds.pad(0.3));
                    console.log('锔 Events clustered - fitted to region bounds');
                } else {
                    // Events spread globally - continental/global view
                    map.fitBounds(bounds.pad(0.1));
                }
            } else {
                // No valid coordinates - reset to global view
                map.setView([20, 0], 2);
            }
            
            console.log(`猴 Map updated with ${validEvents} events on global view`);
        }

        // Check if events are clustered in nearby area
        function isNearbyEventsCluster(bounds) {
            const latDiff = Math.abs(bounds.getNorth() - bounds.getSouth());
            const lngDiff = Math.abs(bounds.getEast() - bounds.getWest());
            
            // If lat/lng difference is small, it's a local cluster
            return latDiff < 5 && lngDiff < 5;
        }

        // Get country flag emoji
        function getCountryFlag(countryCode) {
            const flags = {
                'PL': '叼', 'US': '吼', 'GB': '', 'DE': '', 'FR': '',
                'IT': '', 'ES': '', 'NL': '仇', 'BE': 'ю', 'CH': '',
                'AT': '', 'CZ': '', 'SK': '葛', 'HU': '', 'SE': '葛',
                'NO': '仇', 'DK': '', 'FI': '', 'CA': '', 'AU': '',
                'NZ': '仇', 'JP': '', 'KR': '梆', 'SG': '葛', 'MX': '拆',
                'BR': 'ю', 'AR': '', 'RU': '佛', 'IN': '', 'CN': ''
            };
            return flags[countryCode] || '';
        }

        // Focus map on specific country when selected
        function focusMapOnCountry(countryCode) {
            const countryCoordinates = {
                'PL': [52.2297, 19.4514, 6],     // Poland
                'US': [39.8283, -98.5795, 4],    // USA  
                'GB': [55.3781, -3.4360, 6],     // UK
                'DE': [51.1657, 10.4515, 6],     // Germany
                'FR': [46.6034, 1.8883, 6],      // France
                'IT': [41.8719, 12.5674, 6],     // Italy
                'ES': [40.4637, -3.7492, 6],     // Spain
                'NL': [52.1326, 5.2913, 7],      // Netherlands
                'BE': [50.5039, 4.4699, 8],      // Belgium
                'CH': [46.8182, 8.2275, 8],      // Switzerland
                'AT': [47.5162, 14.5501, 7],     // Austria
                'CZ': [49.8175, 15.4730, 7],     // Czech Republic
                'SK': [48.6690, 19.6990, 8],     // Slovakia
                'HU': [47.1625, 19.5033, 7],     // Hungary
                'SE': [60.1282, 18.6435, 5],     // Sweden
                'NO': [60.4720, 8.4689, 5],      // Norway
                'DK': [56.2639, 9.5018, 7],      // Denmark
                'FI': [61.9241, 25.7482, 5],     // Finland
                'IE': [53.1424, -7.6921, 7],     // Ireland
                'PT': [39.3999, -8.2245, 6],     // Portugal
                'GR': [39.0742, 21.8243, 6],     // Greece
                'RO': [45.9432, 24.9668, 6],     // Romania
                'BG': [42.7339, 25.4858, 6],     // Bulgaria
                'HR': [45.1000, 15.2000, 7],     // Croatia
                'SI': [46.1512, 14.9955, 8],     // Slovenia
                'EE': [58.5953, 25.0136, 7],     // Estonia
                'LV': [56.8796, 24.6032, 7],     // Latvia
                'LT': [55.1694, 23.8813, 7],     // Lithuania
                'CA': [56.1304, -106.3468, 4],   // Canada
                'AU': [-25.2744, 133.7751, 4],   // Australia
                'NZ': [-40.9006, 174.8860, 6],   // New Zealand
                'JP': [36.2048, 138.2529, 5],    // Japan
                'KR': [35.9078, 127.7669, 7],    // South Korea
                'SG': [1.3521, 103.8198, 11],    // Singapore
                'MX': [23.6345, -102.5528, 5],   // Mexico
                'BR': [-14.2350, -51.9253, 4],   // Brazil
                'AR': [-38.4161, -63.6167, 5]    // Argentina
            };
            
            const coords = countryCoordinates[countryCode];
            if (coords) {
                map.setView([coords[0], coords[1]], coords[2]);
                console.log(`猴 Map focused on ${countryCode} at zoom ${coords[2]} - coordinates: [${coords[0]}, ${coords[1]}]`);
            } else {
                // Unknown country - use global view
                map.setView([20, 0], 2);
                console.log(`猴 Unknown country ${countryCode}, using global view`);
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('eventsGrid').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner pulse"></div>
                    <p>Finding the best events for you...</p>
                </div>
            `;
        }

        // Show no results with sample data for testing
        function showNoResults() {
            console.log('И Creating sample events with prices for testing...');
            
            // Create sample events with different price scenarios
            const sampleEvents = [
                {
                    id: 'sample1',
                    name: 'Test Concert - With Price',
                    dates: { start: { localDate: '2025-12-15', localTime: '20:00' } },
                    _embedded: { 
                        venues: [{ 
                            name: 'Test Arena', 
                            city: { name: 'Warszawa' },
                            location: { latitude: '52.2297', longitude: '21.0122' }
                        }] 
                    },
                    images: [{ url: 'https://via.placeholder.com/400x200/6C5CE7/FFFFFF?text=Koncert' }],
                    priceRanges: [{ min: 89, max: 299, currency: 'PLN' }],
                    classifications: [{ segment: { name: 'Music' }, genre: { name: 'Rock' } }],
                    url: 'https://www.ticketmaster.pl'
                },
                {
                    id: 'sample2', 
                    name: 'Free Event',
                    dates: { start: { localDate: '2025-11-20', localTime: '18:00' } },
                    _embedded: { 
                        venues: [{ 
                            name: 'City Park', 
                            city: { name: 'Krakow' },
                            location: { latitude: '50.0647', longitude: '19.9450' }
                        }] 
                    },
                    images: [{ url: 'https://via.placeholder.com/400x200/00B894/FFFFFF?text=Free' }],
                    accessibility: { info: 'Free admission' },
                    classifications: [{ segment: { name: 'Arts & Theatre' }, genre: { name: 'Festival' } }],
                    url: 'https://www.ticketmaster.pl'
                },
                {
                    id: 'sample3',
                    name: 'Theater Show - No API Price',
                    dates: { start: { localDate: '2025-11-25', localTime: '19:30' } },
                    _embedded: { 
                        venues: [{ 
                            name: 'National Theater', 
                            city: { name: 'Warsaw' },
                            location: { latitude: '52.2297', longitude: '21.0122' }
                        }] 
                    },
                    images: [{ url: 'https://via.placeholder.com/400x200/FD79A8/FFFFFF?text=Theater' }],
                    classifications: [{ segment: { name: 'Arts & Theatre' }, genre: { name: 'Drama' } }],
                    url: 'https://www.ticketmaster.pl'
                }
            ];
            
            console.log(' Displaying sample events:', sampleEvents);
            eventsData = sampleEvents;
            displayEvents(sampleEvents);
            updateMap(sampleEvents);
            
            document.querySelector('.results-title').textContent = 
                `Sample events (${sampleEvents.length}) - different price scenarios`;
        }

        // Show error
        function showError(message) {
            document.getElementById('eventsGrid').innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <h3>An error occurred</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Toggle view between grid and map
        function toggleView(view) {
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            const contentLayout = document.getElementById('contentLayout');
            
            toggleBtns.forEach(btn => btn.classList.remove('active'));
            event.target.closest('.toggle-btn').classList.add('active');
            
            if (view === 'map') {
                contentLayout.classList.add('map-hidden');
                document.getElementById('mapContainer').style.display = 'block';
                setTimeout(() => map.invalidateSize(), 100);
            } else {
                contentLayout.classList.remove('map-hidden');
                document.getElementById('mapContainer').style.display = 'block';
            }
        }

        // Event actions
        function openEventDetails(eventId) {
            const event = eventsData.find(e => e.id === eventId);
            if (event) {
                // Create modal or redirect to event page
                window.open(event.url, '_blank');
            }
        }

        function buyTickets(url) {
            // Track ticket purchase intent
            if (typeof gtag !== 'undefined') {
                gtag('event', 'ticket_purchase_intent', {
                    'event_category': 'conversions',
                    'event_label': 'ticketmaster_redirect'
                });
            }
            
            // Add UTM parameters for tracking
            const trackedUrl = url + (url.includes('?') ? '&' : '?') + 
                'utm_source=eventfinder&utm_medium=website&utm_campaign=ticket_sales';
            
            window.open(trackedUrl, '_blank');
        }

        // Newsletter subscription
        function subscribeNewsletter() {
            const email = document.getElementById('newsletterEmail').value;
            
            if (!email || !email.includes('@')) {
                showNotification(' Please enter a valid email address', 'error');
                return;
            }
            
            // Store email locally (in production, send to your backend)
            const subscribers = JSON.parse(localStorage.getItem('newsletterSubscribers') || '[]');
            
            if (!subscribers.find(s => s.email === email)) {
                subscribers.push({
                    email: email,
                    date: new Date().toISOString(),
                    source: 'EventFinder'
                });
                localStorage.setItem('newsletterSubscribers', JSON.stringify(subscribers));
                
                // Success message
                showNotification(' Thank you! We have subscribed you to the newsletter!', 'success');
                document.getElementById('newsletterEmail').value = '';
                
                // Track conversion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'newsletter_signup', {
                        'event_category': 'engagement',
                        'event_label': 'newsletter'
                    });
                }
            } else {
                showNotification(' This email is already subscribed!', 'info');
            }
        }

        // Show notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const colors = {
                success: '#00B894',
                error: '#FF7675', 
                info: '#74B9FF'
            };
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.success};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                animation: slideInRight 0.3s ease-out;
                max-width: 300px;
            `;
            
            notification.innerHTML = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function addToFavorites(eventId) {
            // Add to favorites logic
            console.log('Added to favorites:', eventId);
            // You could save to localStorage or send to backend
        }

        // Check if event is sponsored
        function checkIfSponsored(event) {
            // List of sponsored venues/organizers (would come from database in production)
            const sponsoredVenues = [
                'Palladium',
                'Tauron Arena',
                'Spodek',
                'Club Kwadrat',
                'Proxima'
            ];
            
            const sponsoredOrganizers = [
                'Live Nation',
                'Eventim',
                'TicketPro'
            ];
            
            // Check venue
            const venue = event._embedded?.venues?.[0]?.name || '';
            if (sponsoredVenues.some(sv => venue.toLowerCase().includes(sv.toLowerCase()))) {
                return true;
            }
            
            // Check organizer/promoter
            const promoter = event.promoter?.name || event._embedded?.attractions?.[0]?.name || '';
            if (sponsoredOrganizers.some(so => promoter.toLowerCase().includes(so.toLowerCase()))) {
                return true;
            }
            
            // Random 15% chance for demo purposes (remove in production)
            return Math.random() < 0.15;
        }

        // Premium upgrade function
        function upgradeToPremium() {
            // Check if user already has premium
            const isPremium = localStorage.getItem('isPremium') === 'true';
            
            if (isPremium) {
                showNotification(' You already have active Premium! Thank you for your support.', 'info');
                return;
            }
            
            // Show payment options
            showPaymentModal();
        }

        function showPaymentModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(15px);
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(26, 29, 58, 0.95), rgba(108, 92, 231, 0.1));
                    padding: 3rem;
                    border-radius: 25px;
                    max-width: 500px;
                    width: 90%;
                    border: 2px solid rgba(157, 78, 221, 0.3);
                    position: relative;
                    text-align: center;
                ">
                    <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                            style="position: absolute; top: 1rem; right: 1rem; background: rgba(255, 255, 255, 0.1); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 1.2rem;">
                        
                    </button>
                    
                    <div style="font-size: 4rem; margin-bottom: 1rem;"></div>
                    <h2 style="color: var(--text-light); margin-bottom: 1rem; font-size: 1.8rem;">EventFinder Premium</h2>
                    
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
                                <div style="color: var(--primary-purple); font-weight: 600;">SMS Notifications</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Get SMS about new events</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
                                <div style="color: var(--primary-purple); font-weight: 600;">Calendar Sync</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Auto-add to Google Calendar</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">猸</div>
                                <div style="color: var(--primary-purple); font-weight: 600;">Unlimited Favorites</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Unlimited number of artists</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;"></div>
                                <div style="color: var(--primary-purple); font-weight: 600;">AI Recommendations</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Personalized suggestions</div>
                            </div>
                        </div>
                        
                        <div style="font-size: 2.5rem; color: var(--primary-pink); font-weight: bold; margin-bottom: 0.5rem;">$19.99/month</div>
                        <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 2rem;">cancel anytime  first payment after 7 days</div>
                    </div>
                    
                    <div style="display: grid; gap: 1rem;">
                        <button onclick="startStripePayment()" 
                                style="background: linear-gradient(135deg, var(--primary-purple), var(--primary-pink)); 
                                       border: none; padding: 1.2rem; border-radius: 12px; 
                                       color: white; font-weight: 600; font-size: 1.1rem; cursor: pointer;
                                       box-shadow: 0 8px 30px rgba(157, 78, 221, 0.4);
                                       transition: all 0.3s ease;">
                             Pay securely via Stripe
                        </button>
                        
                        <button onclick="startBlikPayment()" 
                                style="background: linear-gradient(135deg, #e74c3c, #c0392b); 
                                       border: none; padding: 1.2rem; border-radius: 12px; 
                                       color: white; font-weight: 600; font-size: 1.1rem; cursor: pointer;
                                       transition: all 0.3s ease;">
                             BLIK (Polish standard)
                        </button>
                        
                        <button onclick="showTrialOption()" 
                                style="background: rgba(255, 255, 255, 0.1); 
                                       border: 1px solid rgba(255, 255, 255, 0.2); 
                                       padding: 1rem; border-radius: 12px; 
                                       color: white; font-weight: 600; cursor: pointer;
                                       transition: all 0.3s ease;">
                             Start 7-day trial
                        </button>
                    </div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(108, 92, 231, 0.1); border-radius: 12px;">
                        <div style="color: var(--text-gray); font-size: 0.9rem;">
                             <strong>Secure payments</strong> via Stripe and PayU<br>
                             <strong>Cancel</strong> anytime without additional fees<br>
                             <strong>We support</strong> all cards and BLIK
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Track premium modal view
            if (typeof gtag !== 'undefined') {
                gtag('event', 'premium_modal_view', {
                    'event_category': 'monetization',
                    'event_label': 'payment_modal'
                });
            }
        }

        function startStripePayment() {
            // In production: redirect to Stripe Checkout
            const stripeUrl = 'https://checkout.stripe.com/pay/cs_test_premium_subscription';
            
            // For demo: simulate payment success
            showNotification(' Redirecting to Stripe...', 'info');
            
            setTimeout(() => {
                // Simulate successful payment
                localStorage.setItem('isPremium', 'true');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                
                document.querySelector('[style*="position: fixed"]').remove();
                showNotification(' Premium activated! Welcome to the exclusive EventFinder club!', 'success');
                
                // Track conversion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'premium_purchase', {
                        'event_category': 'monetization',
                        'event_label': 'stripe',
                        'value': 19.99
                    });
                }
            }, 2000);
        }

        function startBlikPayment() {
            // Show BLIK payment form
            const blikModal = document.createElement('div');
            blikModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                backdrop-filter: blur(15px);
            `;
            
            blikModal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, rgba(26, 29, 58, 0.95), rgba(231, 76, 60, 0.1));
                    padding: 2rem;
                    border-radius: 20px;
                    max-width: 400px;
                    width: 90%;
                    border: 2px solid rgba(231, 76, 60, 0.3);
                    text-align: center;
                ">
                    <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
                    <h3 style="color: var(--text-light); margin-bottom: 1.5rem;">BLIK Payment</h3>
                    
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
                        <div style="color: var(--text-light); margin-bottom: 1rem;">Amount: <strong>$19.99</strong></div>
                        <input type="text" id="blikCode" placeholder="Enter BLIK code (6 digits)" 
                               style="width: 100%; padding: 1rem; border: 1px solid rgba(231, 76, 60, 0.3); 
                                      border-radius: 8px; background: rgba(26, 29, 58, 0.6); color: white; 
                                      text-align: center; font-size: 1.2rem; letter-spacing: 2px;"
                               maxlength="6" pattern="[0-9]{6}">
                    </div>
                    
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                                style="flex: 1; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); 
                                       padding: 1rem; border-radius: 8px; color: white; cursor: pointer;">
                            Cancel
                        </button>
                        <button onclick="processBlikPayment()" 
                                style="flex: 1; background: linear-gradient(135deg, #e74c3c, #c0392b); 
                                       border: none; padding: 1rem; border-radius: 8px; 
                                       color: white; font-weight: 600; cursor: pointer;">
                            Pay
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(blikModal);
            
            // Focus on input
            setTimeout(() => {
                document.getElementById('blikCode').focus();
            }, 100);
        }

        function processBlikPayment() {
            const blikCode = document.getElementById('blikCode').value;
            
            if (blikCode.length !== 6 || !/^\d{6}$/.test(blikCode)) {
                showNotification(' BLIK code must have 6 digits!', 'error');
                return;
            }
            
            // Simulate BLIK processing
            showNotification(' Processing BLIK payment...', 'info');
            
            setTimeout(() => {
                // Remove BLIK modal
                document.querySelector('[style*="position: fixed"][style*="z-index: 10001"]').remove();
                // Remove main modal
                document.querySelector('[style*="position: fixed"]').remove();
                
                // Activate premium
                localStorage.setItem('isPremium', 'true');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                
                showNotification(' BLIK payment successful! Premium activated!', 'success');
                
                // Track conversion
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'premium_purchase', {
                        'event_category': 'monetization',
                        'event_label': 'blik',
                        'value': 19.99
                    });
                }
            }, 3000);
        }

        function showTrialOption() {
            if (confirm(' Activate 7-day free Premium trial?\n\nAfter 7 days automatic payment $19.99/month.\nYou can cancel anytime.')) {
                // Close modal
                document.querySelector('[style*="position: fixed"]').remove();
                
                // Activate trial
                localStorage.setItem('isPremium', 'true');
                localStorage.setItem('premiumStartDate', new Date().toISOString());
                localStorage.setItem('isTrialPeriod', 'true');
                
                showNotification(' 7-day trial activated! Enjoy all Premium features!', 'success');
                
                // Track trial start
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'premium_trial_start', {
                        'event_category': 'monetization',
                        'event_label': 'trial'
                    });
                }
            }
        }

        // Show merchandise for artist/event
        function showMerchandise(eventName, artistName) {
            const artist = artistName || eventName;
            
            // Create merchandise popup
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
            `;
            
            popup.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, var(--dark-bg), rgba(26, 29, 58, 0.95));
                    padding: 2rem;
                    border-radius: 20px;
                    max-width: 600px;
                    width: 90%;
                    border: 1px solid rgba(108, 92, 231, 0.3);
                    position: relative;
                ">
                    <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                            style="position: absolute; top: 1rem; right: 1rem; background: rgba(255, 255, 255, 0.1); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">
                        
                    </button>
                    
                    <h3 style="color: var(--text-light); text-align: center; margin-bottom: 1.5rem;">
                         Merchandise & Albums - ${artist}
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div style="text-align: center; padding: 1rem; background: rgba(26, 29, 58, 0.6); border-radius: 12px;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;"></div>
                            <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">T-Shirts</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">Official tour merchandise</p>
                            <button onclick="openAffiliate('allegro', 'koszulka ${artist}')" 
                                    style="background: var(--gradient-primary); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; width: 100%;">
                                Check on Allegro
                            </button>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem; background: rgba(26, 29, 58, 0.6); border-radius: 12px;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;"></div>
                            <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">CD/Vinyl Records</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">Latest albums and classics</p>
                            <button onclick="openAffiliate('empik', 'pyta ${artist}')" 
                                    style="background: var(--gradient-primary); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; width: 100%;">
                                Check at Empik
                            </button>
                        </div>
                        
                        <div style="text-align: center; padding: 1rem; background: rgba(26, 29, 58, 0.6); border-radius: 12px;">
                            <div style="font-size: 3rem; margin-bottom: 0.5rem;"></div>
                            <h4 style="color: var(--primary-purple); margin-bottom: 0.5rem;">Accessories</h4>
                            <p style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">Headphones, posters, gadgets</p>
                            <button onclick="openAffiliate('amazon', 'gad偶ety muzyczne ${artist}')" 
                                    style="background: var(--gradient-primary); border: none; padding: 0.5rem 1rem; border-radius: 8px; color: white; cursor: pointer; width: 100%;">
                                Check on Amazon
                            </button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: rgba(157, 78, 221, 0.1); border-radius: 12px;">
                        <p style="color: var(--text-gray); font-size: 0.9rem;">
                             <strong>Support EventFinder:</strong> Purchases through our links support platform development
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Track merchandise interest
            if (typeof gtag !== 'undefined') {
                gtag('event', 'merchandise_view', {
                    'event_category': 'monetization',
                    'event_label': artist
                });
            }
        }

        // Open affiliate links
        function openAffiliate(platform, searchTerm) {
            const affiliateLinks = {
                allegro: `https://allegro.pl/listing?string=${encodeURIComponent(searchTerm)}&bmatch=baseline-product-cl-engag-dict43-ele-1-2-1204`,
                empik: `https://empik.com/searchq=${encodeURIComponent(searchTerm)}`,
                amazon: `https://amazon.pl/s?k=${encodeURIComponent(searchTerm)}&tag=eventfinder-21`
            };
            
            const url = affiliateLinks[platform] || `https://google.com/search?q=${encodeURIComponent(searchTerm)} site:${platform}.pl`;
            
            // Track affiliate clicks
            if (typeof gtag !== 'undefined') {
                gtag('event', 'affiliate_click', {
                    'event_category': 'monetization',
                    'event_label': platform,
                    'custom_parameter_1': searchTerm
                });
            }
            
            window.open(url, '_blank');
        }

        // Follow artist for notifications
        function followArtist(artistName, artistId) {
            const followedArtists = JSON.parse(localStorage.getItem('followedArtists') || '[]');
            
            // Check if already following
            const isAlreadyFollowing = followedArtists.some(artist => artist.id === artistId);
            
            if (isAlreadyFollowing) {
                showNotification(' You are already following this artist!', 'info');
                return;
            }
            
            // Add to followed artists
            followedArtists.push({
                id: artistId,
                name: artistName,
                followedDate: new Date().toISOString()
            });
            
            localStorage.setItem('followedArtists', JSON.stringify(followedArtists));
            
            // Show premium upsell for more than 3 followed artists
            if (followedArtists.length > 3) {
                showNotification(` Following ${artistName}! Upgrade to Premium for unlimited artists and SMS notifications.`, 'info');
                
                setTimeout(() => {
                    if (confirm(' Upgrade to Premium for $19.99/month?\n\n Unlimited followed artists\n SMS notifications\n Calendar sync\n Early ticket access')) {
                        upgradeToPremium();
                    }
                }, 2000);
            } else {
                showNotification(` Now following ${artistName}! (${followedArtists.length}/3 free)`, 'success');
            }
            
            // Track follow action
            if (typeof gtag !== 'undefined') {
                gtag('event', 'artist_follow', {
                    'event_category': 'engagement',
                    'event_label': artistName,
                    'custom_parameter_1': followedArtists.length
                });
            }
        }

        // Generate sample reviews for demo
        function generateSampleReviews() {
            const reviews = [
                { rating: 5, comment: "Amazing concert!", author: "Musik_Fan" },
                { rating: 4, comment: "Great atmosphere", author: "ConcertLover" },
                { rating: 5, comment: "Highly recommend!", author: "LiveMusic" }
            ];
            
            const randomReviews = reviews.sort(() => 0.5 - Math.random()).slice(0, 2);
            const avgRating = randomReviews.reduce((sum, r) => sum + r.rating, 0) / randomReviews.length;
            
            return `
                <div>
                    ${'猸'.repeat(Math.round(avgRating))} ${avgRating.toFixed(1)}
                </div>
                <div style="color: var(--text-muted);">
                    (${randomReviews.length + Math.floor(Math.random() * 10)} ratings)
                </div>
            `;
        }

        // Show reviews popup
        function showReviews(eventId, eventName) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
            `;
            
            popup.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, var(--dark-bg), rgba(26, 29, 58, 0.95));
                    padding: 2rem;
                    border-radius: 20px;
                    max-width: 700px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    border: 1px solid rgba(108, 92, 231, 0.3);
                    position: relative;
                ">
                    <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                            style="position: absolute; top: 1rem; right: 1rem; background: rgba(255, 255, 255, 0.1); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer;">
                        
                    </button>
                    
                    <h3 style="color: var(--text-light); text-align: center; margin-bottom: 1.5rem;">
                        猸 Reviews - ${eventName}
                    </h3>
                    
                    <!-- Add Review Form -->
                    <div style="background: rgba(26, 29, 58, 0.6); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <h4 style="color: var(--primary-purple); margin-bottom: 1rem;">Add your review</h4>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: var(--text-light); display: block; margin-bottom: 0.5rem;">Rating:</label>
                            <div id="rating-stars" style="font-size: 1.5rem; margin-bottom: 1rem;">
                                <span onclick="setRating(1)" style="cursor: pointer; color: #ddd;">猸</span>
                                <span onclick="setRating(2)" style="cursor: pointer; color: #ddd;">猸</span>
                                <span onclick="setRating(3)" style="cursor: pointer; color: #ddd;">猸</span>
                                <span onclick="setRating(4)" style="cursor: pointer; color: #ddd;">猸</span>
                                <span onclick="setRating(5)" style="cursor: pointer; color: #ddd;">猸</span>
                            </div>
                        </div>
                        
                        <textarea id="reviewText" placeholder="Describe your experience at the event..." 
                                  style="width: 100%; min-height: 80px; padding: 0.8rem; border: 1px solid rgba(108, 92, 231, 0.3); border-radius: 8px; background: rgba(26, 29, 58, 0.6); color: white; resize: vertical; margin-bottom: 1rem;"></textarea>
                        
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="submitReview('${eventId}', '${eventName}')" 
                                    style="flex: 1; background: var(--gradient-primary); border: none; padding: 0.8rem; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                                Add review
                            </button>
                            <button onclick="showPremiumReviewFeatures()" 
                                    style="background: linear-gradient(135deg, #FFD700, #FFA500); border: none; padding: 0.8rem 1rem; border-radius: 8px; color: #000; font-weight: 600; cursor: pointer;">
                                 Premium Review
                            </button>
                        </div>
                    </div>
                    
                    <!-- Sample Reviews -->
                    <div style="space-y: 1rem;">
                        <div style="background: rgba(26, 29, 58, 0.4); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-light); font-weight: 600;">Musik_Fan</span>
                                <span style="color: #FFD700;">猸猸猸猸猸</span>
                            </div>
                            <p style="color: var(--text-gray); margin: 0;">Amazing concert! The atmosphere was electrifying, the band played fantastically. Definitely recommend!</p>
                        </div>
                        
                        <div style="background: rgba(26, 29, 58, 0.4); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-light); font-weight: 600;">ConcertLover</span>
                                <span style="color: #FFD700;">猸猸猸猸</span>
                            </div>
                            <p style="color: var(--text-gray); margin: 0;">Great organization, good sound system. Only downside was long lines at the bar.</p>
                        </div>
                        
                        <!-- Premium Review Badge -->
                        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1)); padding: 1rem; border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #FFD700; font-weight: 600;"> Premium Reviewer</span>
                                <span style="color: #FFD700;">猸猸猸猸猸</span>
                            </div>
                            <p style="color: var(--text-gray); margin: 0.5rem 0 0 0;">Detailed review with additional photos and videos available for Premium subscribers.</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            // Track review view
            if (typeof gtag !== 'undefined') {
                gtag('event', 'reviews_view', {
                    'event_category': 'engagement',
                    'event_label': eventName
                });
            }
        }

        let currentRating = 0;
        
        function setRating(rating) {
            currentRating = rating;
            const stars = document.querySelectorAll('#rating-stars span');
            stars.forEach((star, index) => {
                star.style.color = index < rating ? '#FFD700' : '#ddd';
            });
        }

        function submitReview(eventId, eventName) {
            const reviewText = document.getElementById('reviewText').value;
            
            if (currentRating === 0) {
                showNotification('猸 Choose a rating!', 'error');
                return;
            }
            
            if (reviewText.trim().length < 10) {
                showNotification(' Review must have at least 10 characters!', 'error');
                return;
            }
            
            // Save review locally (in production: send to backend)
            const reviews = JSON.parse(localStorage.getItem('userReviews') || '[]');
            reviews.push({
                eventId: eventId,
                eventName: eventName,
                rating: currentRating,
                text: reviewText,
                date: new Date().toISOString(),
                author: 'Anonymous User'
            });
            localStorage.setItem('userReviews', JSON.stringify(reviews));
            
            showNotification(' Thank you for your review!', 'success');
            
            // Track review submission
            if (typeof gtag !== 'undefined') {
                gtag('event', 'review_submit', {
                    'event_category': 'engagement',
                    'event_label': eventName,
                    'custom_parameter_1': currentRating
                });
            }
            
            // Close popup
            document.querySelector('[style*="position: fixed"]').remove();
        }

        function showPremiumReviewFeatures() {
            showNotification(' Premium Reviews: Add photos, videos and get higher review ranking! Upgrade for $19.99/month.', 'info');
            
            setTimeout(() => {
                if (confirm(' Upgrade to Premium for $19.99/month?\n\n Reviews with photos and videos\n Higher review ranking\n "Premium Reviewer" badge\n Access to exclusive reviews')) {
                    upgradeToPremium();
                }
            }, 1500);
        }

        // Social Media Sharing Functions
        function shareToFacebook(eventName, eventUrl, imageUrl) {
            const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(eventUrl)}&quote=${encodeURIComponent(` Check out this amazing event: ${eventName}! #EventFinder #Events`)}`;
            openSocialWindow(shareUrl, 'Facebook');
            
            // Track sharing
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'method': 'Facebook',
                    'content_type': 'event',
                    'item_id': eventName
                });
            }
        }

        function shareToTwitter(eventName, eventUrl) {
            const text = ` I found a great event: ${eventName}! Check it out on EventFinder `;
            const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(eventUrl)}&hashtags=EventFinder,Events,Concert`;
            openSocialWindow(shareUrl, 'Twitter');
            
            // Track sharing
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'method': 'Twitter',
                    'content_type': 'event',
                    'item_id': eventName
                });
            }
        }

        function shareToInstagram(eventName, imageUrl) {
            // Instagram doesn't have direct sharing API, so we copy event info
            const instagramText = ` ${eventName}\n\n Found on EventFinder\n#EventFinder #Events #Concert #Music`;
            
            if (navigator.share) {
                navigator.share({
                    title: eventName,
                    text: instagramText,
                    url: imageUrl || window.location.href
                }).catch(err => console.log('Error sharing:', err));
            } else {
                copyToClipboard(instagramText);
                showNotification(' Text copied! Paste in Instagram Stories or Posts', 'success');
            }
            
            // Track sharing attempt
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'method': 'Instagram',
                    'content_type': 'event',
                    'item_id': eventName
                });
            }
        }

        function shareToWhatsApp(eventName, eventUrl) {
            const message = ` Hey! Check out this event: *${eventName}*\n\n Link: ${eventUrl}\n\n Found via EventFinder`;
            const shareUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(shareUrl, '_blank');
            
            // Track sharing
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'method': 'WhatsApp',
                    'content_type': 'event',
                    'item_id': eventName
                });
            }
        }

        function copyEventLink(eventUrl, eventName) {
            const fullMessage = ` ${eventName}\n\n Link: ${eventUrl}\n\n Found on EventFinder`;
            
            copyToClipboard(fullMessage);
            showNotification(' Event link copied! You can now paste it anywhere you want.', 'success');
            
            // Track copy action
            if (typeof gtag !== 'undefined') {
                gtag('event', 'share', {
                    'method': 'Copy Link',
                    'content_type': 'event',
                    'item_id': eventName
                });
            }
        }

        function openSocialWindow(url, platform) {
            const width = 600;
            const height = 400;
            const left = (screen.width - width) / 2;
            const top = (screen.height - height) / 2;
            
            window.open(url, `share${platform}`, `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`);
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // Global Events Counter Functions
        let globalCounterCache = {
            data: null,
            timestamp: 0,
            expires: 10 * 60 * 1000 // 10 minutes cache
        };

        async function fetchGlobalEventStats() {
            const now = Date.now();
            
            // Return cached data if still valid
            if (globalCounterCache.data && (now - globalCounterCache.timestamp) < globalCounterCache.expires) {
                return globalCounterCache.data;
            }

            try {
                // Fetch sample data from multiple markets for estimation
                const markets = ['US', 'GB', 'DE', 'FR', 'IT', 'ES', 'NL', 'CA', 'AU', 'PL'];
                const promises = markets.map(async (market) => {
                    try {
                        const url = `${TICKETMASTER_API.baseUrl}/events?apikey=${TICKETMASTER_API.key}&countryCode=${market}&size=1&page=0`;
                        const response = await fetch(url);
                        const data = await response.json();
                        return {
                            market,
                            total: data.page ? data.page.totalElements : 0
                        };
                    } catch (error) {
                        console.log(`Error fetching ${market}:`, error);
                        return { market, total: 0 };
                    }
                });

                const results = await Promise.all(promises);
                const stats = calculateGlobalStats(results);
                
                // Cache the results
                globalCounterCache.data = stats;
                globalCounterCache.timestamp = now;
                
                return stats;
            } catch (error) {
                console.error('Error fetching global stats:', error);
                // Return fallback estimates
                return {
                    totalEvents: 125000,
                    countries: 28,
                    cities: 850,
                    todayEvents: 1200
                };
            }
        }

        function calculateGlobalStats(marketData) {
            const totalFromSamples = marketData.reduce((sum, market) => sum + market.total, 0);
            
            // Estimation based on market coverage (these 10 markets = ~60% of global events)
            const estimatedTotal = Math.round(totalFromSamples * 1.67);
            
            // Calculate other stats
            const countries = marketData.filter(m => m.total > 0).length + 18; // Add non-sampled countries
            const avgCitiesPerCountry = 30;
            const cities = countries * avgCitiesPerCountry;
            const todayEvents = Math.round(estimatedTotal * 0.008); // ~0.8% daily rate
            
            return {
                totalEvents: estimatedTotal,
                countries: countries,
                cities: cities,
                todayEvents: todayEvents
            };
        }

        function animateCounter(element, finalValue, duration = 2000) {
            const startValue = 0;
            const startTime = Date.now();
            
            function updateCounter() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function for smooth animation
                const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.round(startValue + (finalValue - startValue) * easeOutCubic);
                
                element.textContent = formatNumber(currentValue);
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    element.textContent = formatNumber(finalValue);
                }
            }
            
            updateCounter();
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(0) + 'K';
            }
            return num.toString();
        }

        async function updateGlobalCounter() {
            try {
                const stats = await fetchGlobalEventStats();
                
                // Animate main counter
                const mainCounter = document.querySelector('#globalEventCounter .counter-value');
                if (mainCounter) {
                    animateCounter(mainCounter, stats.totalEvents, 2500);
                }
                
                // Animate stat counters
                setTimeout(() => {
                    const countriesEl = document.getElementById('countriesCount');
                    const citiesEl = document.getElementById('citiesCount');
                    const todayEl = document.getElementById('todayCount');
                    
                    if (countriesEl) animateCounter(countriesEl, stats.countries, 1500);
                    if (citiesEl) animateCounter(citiesEl, stats.cities, 1800);
                    if (todayEl) animateCounter(todayEl, stats.todayEvents, 2000);
                }, 500);
                
                console.log(' Global counter updated:', stats);
            } catch (error) {
                console.error('Error updating global counter:', error);
            }
        }

        // Auto-refresh counter every 10 minutes
        function startGlobalCounterRefresh() {
            setInterval(updateGlobalCounter, 10 * 60 * 1000);
        }

        // Personalized Recommendations Engine
        let userPreferences = {
            genres: ['Music', 'Theatre', 'Sports', 'Comedy'],
            location: 'Poland',
            priceRange: 'any',
            timePreference: 'evening',
            interests: []
        };

        async function fetchRecommendations() {
            try {
                // Get user's location or default
                const userLocation = userPreferences.location;
                const genres = ['concert', 'theatre', 'sports', 'comedy', 'festival'];
                
                const recommendations = [];
                
                // Fetch trending events from different categories
                for (const genre of genres.slice(0, 3)) {
                    try {
                        const url = `${TICKETMASTER_API.baseUrl}/events?apikey=${TICKETMASTER_API.key}&keyword=${genre}&size=2&sort=date,asc`;
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        if (data._embedded && data._embedded.events) {
                            const events = data._embedded.events.map(event => ({
                                ...event,
                                recommendationScore: calculateRecommendationScore(event, genre),
                                recommendationReason: getRecommendationReason(event, genre)
                            }));
                            recommendations.push(...events);
                        }
                    } catch (error) {
                        console.log(`Error fetching ${genre} recommendations:`, error);
                    }
                }
                
                // Sort by recommendation score and return top 6
                return recommendations
                    .sort((a, b) => b.recommendationScore - a.recommendationScore)
                    .slice(0, 6);
                    
            } catch (error) {
                console.error('Error fetching recommendations:', error);
                return [];
            }
        }

        function calculateRecommendationScore(event, genre) {
            let score = 50; // Base score
            
            // Boost score based on genre preference
            if (userPreferences.genres.includes(genre)) score += 20;
            
            // Boost popular events
            if (event.pleaseNote && event.pleaseNote.includes('sold')) score += 15;
            
            // Boost events with images
            if (event.images && event.images.length > 0) score += 10;
            
            // Boost events happening soon
            const eventDate = new Date(event.dates?.start?.localDate);
            const now = new Date();
            const daysUntil = (eventDate - now) / (1000 * 60 * 60 * 24);
            if (daysUntil <= 7) score += 25; // This week
            else if (daysUntil <= 30) score += 15; // This month
            
            // Random factor for variety
            score += Math.random() * 10;
            
            return Math.min(100, Math.max(0, score));
        }

        function getRecommendationReason(event, genre) {
            const reasons = [
                ` Popular ${genre}`,
                ' Trending now',
                '猸 High ratings',
                ' In your area',
                ' Limited tickets',
                ' Recommended for you'
            ];
            return reasons[Math.floor(Math.random() * reasons.length)];
        }

        async function displayRecommendations() {
            const grid = document.getElementById('recommendationsGrid');
            
            try {
                const recommendations = await fetchRecommendations();
                
                if (recommendations.length === 0) {
                    grid.innerHTML = `
                        <div class="recommendation-loading">
                            <p> No recommendations found. Try adjusting your preferences.</p>
                        </div>
                    `;
                    return;
                }
                
                grid.innerHTML = recommendations.map(event => {
                    const eventDate = event.dates?.start?.localDate || 'TBA';
                    const eventTime = event.dates?.start?.localTime || '';
                    const venue = event._embedded?.venues?.[0]?.name || 'Venue TBA';
                    const city = event._embedded?.venues?.[0]?.city?.name || 'City TBA';
                    const image = event.images?.[0]?.url || 'https://via.placeholder.com/300x200/6C5CE7/FFFFFF?text=Event';
                    const priceMin = event.priceRanges?.[0]?.min || 'TBA';
                    const priceCurrency = event.priceRanges?.[0]?.currency || 'PLN';
                    
                    return `
                        <div class="recommendation-card" onclick="showEventDetails('${event.id}')">
                            <div class="recommendation-score">${Math.round(event.recommendationScore)}% match</div>
                            <div class="recommendation-badge">${event.recommendationReason}</div>
                            
                            <div style="margin-bottom: 1rem;">
                                <img src="${image}" alt="${event.name}" 
                                     style="width: 100%; height: 120px; object-fit: cover; border-radius: 10px;">
                            </div>
                            
                            <h3 style="color: var(--text-light); font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.2;">
                                ${event.name}
                            </h3>
                            
                            <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 1rem;">
                                <div> ${eventDate} ${eventTime}</div>
                                <div> ${venue}, ${city}</div>
                                ${priceMin !== 'TBA' ? `<div> od ${priceMin} ${priceCurrency}</div>` : ''}
                            </div>
                            
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn-quick-buy" style="flex: 1; background: var(--primary-purple); color: white; border: none; padding: 0.6rem; border-radius: 8px; font-weight: 600; cursor: pointer;">
                                     Bilety
                                </button>
                                <button class="btn-save-event" style="background: rgba(108, 92, 231, 0.1); color: var(--primary-purple); border: 1px solid var(--primary-purple); padding: 0.6rem; border-radius: 8px; cursor: pointer;">
                                    わ
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Track recommendations display
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'recommendations_display', {
                        'event_category': 'engagement',
                        'event_label': 'personalized_recommendations',
                        'value': recommendations.length
                    });
                }
                
            } catch (error) {
                console.error('Error displaying recommendations:', error);
                grid.innerHTML = `
                    <div class="recommendation-loading">
                        <p> Error loading recommendations. Please try again.</p>
                    </div>
                `;
            }
        }

        function refreshRecommendations() {
            const grid = document.getElementById('recommendationsGrid');
            grid.innerHTML = `
                <div class="recommendation-loading">
                    <div class="loading-spinner"></div>
                    <p>Looking for new recommendations...</p>
                </div>
            `;
            
            // Randomize preferences slightly for variety
            userPreferences.interests = ['trending', 'popular', 'new'];
            
            setTimeout(() => {
                displayRecommendations();
            }, 1000);
        }

        function showPreferences() {
            const popup = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: var(--bg-card); padding: 2rem; border-radius: 20px; max-width: 500px; width: 90%;">
                        <h3 style="color: var(--text-light); margin-bottom: 1.5rem;"> Customize your preferences</h3>
                        
                        <div style="margin-bottom: 1rem;">
                            <label style="color: var(--text-gray); display: block; margin-bottom: 0.5rem;">Favorite genres:</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <button onclick="toggleGenre('Music')" style="padding: 0.5rem 1rem; border-radius: 15px; border: 1px solid var(--primary-purple); background: rgba(108, 92, 231, 0.1); color: var(--text-light);"> Music</button>
                                <button onclick="toggleGenre('Theatre')" style="padding: 0.5rem 1rem; border-radius: 15px; border: 1px solid var(--primary-purple); background: rgba(108, 92, 231, 0.1); color: var(--text-light);"> Theater</button>
                                <button onclick="toggleGenre('Sports')" style="padding: 0.5rem 1rem; border-radius: 15px; border: 1px solid var(--primary-purple); background: rgba(108, 92, 231, 0.1); color: var(--text-light);"> Sports</button>
                                <button onclick="toggleGenre('Comedy')" style="padding: 0.5rem 1rem; border-radius: 15px; border: 1px solid var(--primary-purple); background: rgba(108, 92, 231, 0.1); color: var(--text-light);"> Comedy</button>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button onclick="savePreferences()" style="flex: 1; background: var(--primary-purple); color: white; border: none; padding: 1rem; border-radius: 10px; font-weight: 600;"> Save</button>
                            <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" style="flex: 1; background: rgba(255,255,255,0.1); color: var(--text-light); border: none; padding: 1rem; border-radius: 10px;"> Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', popup);
        }

        function toggleGenre(genre) {
            // Toggle genre preference (visual feedback would be added in production)
            console.log('Toggled genre:', genre);
        }

        function savePreferences() {
            // Save to localStorage
            localStorage.setItem('eventPreferences', JSON.stringify(userPreferences));
            showNotification(' Preferences saved! Recommendations will be updated.', 'success');
            
            // Close popup and refresh recommendations
            document.querySelector('[style*="position: fixed"]').remove();
            refreshRecommendations();
        }

        // Load saved preferences
        function loadUserPreferences() {
            const saved = localStorage.getItem('eventPreferences');
            if (saved) {
                userPreferences = { ...userPreferences, ...JSON.parse(saved) };
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            
            // Initialize global counter
            updateGlobalCounter();
            startGlobalCounterRefresh();
            
            // Initialize recommendations
            loadUserPreferences();
            displayRecommendations();
            
            // Load some default events on page load
            searchEvents();
            
            // Add enter key support for search
            document.querySelectorAll('.search-input').forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchEvents();
                    }
                });
            });

            // Add country change listener for map focus
            const countrySelect = document.getElementById('country');
            if (countrySelect) {
                countrySelect.addEventListener('change', function(e) {
                    const selectedCountry = e.target.value;
                    if (selectedCountry) {
                        // Focus map on selected country
                        focusMapOnCountry(selectedCountry);
                        console.log(`猴 Country changed to: ${selectedCountry}`);
                    } else {
                        // "Cay wiat" selected - global view
                        map.setView([20, 0], 2);
                        console.log('猴 Global view selected');
                    }
                });
            }

            // Initialize enhanced features
            initScrollIndicator();
            initFloatingParticles();
            initHeaderScrollEffect();
            initScrollAnimations();
            initNotificationStyles();
            
            // Initialize language system
            initializeLanguage();
        });

        // Add notification CSS animations
        function initNotificationStyles() {
            const notificationCSS = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            
            const style = document.createElement('style');
            style.textContent = notificationCSS;
            document.head.appendChild(style);
        }

        // Scroll indicator
        function initScrollIndicator() {
            const scrollProgress = document.getElementById('scrollProgress');
            
            window.addEventListener('scroll', () => {
                const scrollTop = window.pageYOffset;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (scrollTop / docHeight) * 100;
                
                scrollProgress.style.width = scrollPercent + '%';
            });
        }

        // Floating particles
        function initFloatingParticles() {
            const particlesContainer = document.getElementById('floatingParticles');
            
            function createParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';
                
                particlesContainer.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 12000);
            }
            
            // Create initial particles
            for (let i = 0; i < 20; i++) {
                setTimeout(createParticle, i * 300);
            }
            
            // Continue creating particles
            setInterval(createParticle, 2000);
        }

        // Header scroll effect
        function initHeaderScrollEffect() {
            const header = document.querySelector('.header');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
        }

        // Scroll animations for elements
        function initScrollAnimations() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                        observer.unobserve(entry.target);
                    }
                });
            }, observerOptions);
            
            // Observe elements when they're created
            const observeElements = () => {
                document.querySelectorAll('.event-card:not(.fade-in)').forEach(card => {
                    observer.observe(card);
                });
            };
            
            // Initial observation
            setTimeout(observeElements, 100);
            
            // Re-observe when new content is loaded
            const originalDisplayEvents = displayEvents;
            displayEvents = function(events) {
                originalDisplayEvents(events);
                setTimeout(observeElements, 100);
            };
        }

        // Language Switching System
        let currentLanguage = localStorage.getItem('preferredLanguage') || 'en';

        const translations = {
            en: {
                // Navigation
                home: 'Home',
                search: 'Search',
                events: 'Events',
                map: 'Map',
                about: 'About',
                
                // Hero Section
                heroTitle: 'Discover the Best Events',
                heroSubtitle: 'Find amazing concerts, shows and events in your area. Thousands of events are waiting for you!',
                
                // Global Counter
                eventsWorldwide: 'Events worldwide',
                availableNow: 'available now',
                countries: 'countries',
                cities: 'cities',
                today: 'today',
                
                // Recommendations
                recommendedForYou: 'Recommended for You',
                basedOnPreferences: 'Based on your preferences and popular events',
                findingBestEvents: 'Finding the best events for you...',
                refreshRecommendations: 'Refresh Recommendations',
                customizePreferences: 'Customize Preferences',
                
                // Search
                keyword: 'Keyword',
                keywordPlaceholder: 'e.g. concert, theater, comedy...',
                country: 'Country',
                worldwide: 'Worldwide',
                city: 'City',
                cityPlaceholder: 'e.g. Warsaw, London, New York...',
                date: 'Date',
                searchEvents: 'Search Events',
                
                // Results
                searchResults: 'Search Results',
                grid: 'Grid',
                
                // Events
                buyTickets: 'Buy Tickets',
                merch: 'Merch',
                follow: 'Follow',
                userRatings: 'User Ratings',
                viewAll: 'View All',
                pricesVary: 'Prices may vary by seating',
                checkPrice: 'Click "Buy Tickets" to check current price',
                
                // Premium
                premiumTitle: 'EventFinder Premium',
                smsNotifications: 'SMS Notifications',
                calendarSync: 'Calendar Sync',
                unlimitedFavorites: 'Unlimited Favorites',
                onlyPrice: 'only $19.99/month',
                cancelAnytime: 'cancel anytime',
                upgradePremium: 'Upgrade to Premium',
                
                // Newsletter
                dontMiss: "Don't miss the best events!",
                getNotifications: 'Get notifications about new concerts and events in your area',
                yourEmail: 'Your email...',
                subscribe: 'Subscribe',
                
                // Map
                eventsMap: 'Events Map',
                
                // Footer/GDPR
                cookieNotice: 'This site uses cookies and Google AdSense to personalize ads and analyze traffic.',
                privacyPolicy: 'Privacy Policy',
                accept: 'Accept',
                decline: 'Decline',
                
                // About Section
                aboutEventfinder: 'About EventFinder',
                aboutSubtitle: 'Your ultimate destination for discovering amazing events and concerts worldwide. We connect you with unforgettable experiences across the globe.',
                globalEvents: 'Global Events',
                globalEventsDesc: 'Access to over 125,000+ events worldwide through Ticketmaster\'s Discovery API. From concerts to theater, sports to festivals.',
                interactiveMap: 'Interactive Map',
                interactiveMapDesc: 'Visualize events on an interactive world map. Discover what\'s happening near you or explore events in your next travel destination.',
                smartRecommendations: 'Smart Recommendations',
                smartRecommendationsDesc: 'AI-powered recommendations based on your preferences, location, and browsing history. Never miss an event you\'d love.',
                premiumFeatures: 'Premium Features',
                premiumFeaturesDesc: 'SMS notifications, calendar sync, unlimited favorites, and priority customer support for just $19.99/month.',
                multilingual: 'Multilingual',
                multilingualDesc: 'Available in English and Polish with more languages coming soon. Experience EventFinder in your preferred language.',
                mobileFirst: 'Mobile First',
                mobileFirstDesc: 'Fully responsive design that works perfectly on all devices. Find and book events on the go with our mobile-optimized interface.',
                platformStatistics: 'Platform Statistics',
                eventsAvailable: 'Events Available',
                liveUpdates: 'Live Updates',
                getInTouch: 'Get in Touch',
                questionsContact: 'Have questions or suggestions? We\'d love to hear from you!',
                followTwitter: 'Follow us on Twitter'
            },
            pl: {
                // Navigation
                home: 'Home',
                search: 'Szukaj',
                events: 'Eventy',
                map: 'Mapa',
                about: 'O nas',
                
                // Hero Section
                heroTitle: 'Znajd藕 Najlepsze Eventy',
                heroSubtitle: 'Odkryj niesamowite koncerty, spektakle i wydarzenia w Twojej okolicy. Tysice event贸w czeka na Ciebie!',
                
                // Global Counter
                eventsWorldwide: 'Eventy na caym wiecie',
                availableNow: 'dostpnych teraz',
                countries: 'kraj贸w',
                cities: 'miast',
                today: 'dzi',
                
                // Recommendations
                recommendedForYou: 'Polecane dla Ciebie',
                basedOnPreferences: 'Na podstawie Twoich preferencji i popularnych event贸w',
                findingBestEvents: 'Szukamy najlepszych event贸w dla Ciebie...',
                refreshRecommendations: 'Odwie偶 rekomendacje',
                customizePreferences: 'Dostosuj preferencje',
                
                // Search
                keyword: 'Sowo kluczowe',
                keywordPlaceholder: 'np. koncert, teatr, komedia...',
                country: 'Kraj',
                worldwide: 'Cay wiat',
                city: 'Miasto',
                cityPlaceholder: 'np. Warszawa, London, New York...',
                date: 'Data',
                searchEvents: 'Szukaj Eventy',
                
                // Results
                searchResults: 'Wyniki wyszukiwania',
                grid: 'Siatka',
                
                // Events
                buyTickets: 'Kup bilety',
                merch: 'Gad偶ety',
                follow: 'led藕',
                userRatings: 'Oceny u偶ytkownik贸w',
                viewAll: 'Zobacz wszystkie',
                pricesVary: 'Ceny mog si r贸偶ni w zale偶noci od miejsca',
                checkPrice: 'Kliknij "Kup bilety" aby sprawdzi aktualn cen',
                
                // Premium
                premiumTitle: 'EventFinder Premium',
                smsNotifications: 'SMS Powiadomienia',
                calendarSync: 'Sync Kalendarz',
                unlimitedFavorites: 'Unlimited Ulubione',
                onlyPrice: 'tylko 19,99 z/miesic',
                cancelAnytime: 'anuluj w ka偶dej chwili',
                upgradePremium: 'Uaktualnij do Premium',
                
                // Newsletter
                dontMiss: 'Nie przegap najlepszych event贸w!',
                getNotifications: 'Otrzymuj powiadomienia o nowych koncertach i wydarzeniach w Twojej okolicy',
                yourEmail: 'Tw贸j email...',
                subscribe: 'Subskrybuj',
                
                // Map
                eventsMap: 'Mapa Event贸w',
                
                // Footer/GDPR
                cookieNotice: 'Ta strona u偶ywa plik贸w cookie i Google AdSense w celu personalizacji reklam i analizy ruchu.',
                privacyPolicy: 'Polityka Prywatnoci',
                accept: 'Akceptuj',
                decline: 'Odrzu',
                
                // About Section
                aboutEventfinder: 'O EventFinder',
                aboutSubtitle: 'Twoje ultimatywne miejsce do odkrywania niesamowitych event贸w i koncert贸w na caym wiecie. czymy Ci z niezapomnianymi dowiadczeniami na caym globie.',
                globalEvents: 'Eventy Globalne',
                globalEventsDesc: 'Dostp do ponad 125 000+ event贸w na caym wiecie przez Ticketmaster Discovery API. Od koncert贸w po teatr, sport i festiwale.',
                interactiveMap: 'Interaktywna Mapa',
                interactiveMapDesc: 'Wizualizuj eventy na interaktywnej mapie wiata. Odkryj co si dzieje w Twojej okolicy lub eksploruj eventy w nastpnym miejscu podr贸偶y.',
                smartRecommendations: 'Inteligentne Rekomendacje',
                smartRecommendationsDesc: 'Rekomendacje oparte na AI wedug Twoich preferencji, lokalizacji i historii przegldania. Nigdy nie przegap eventu, kt贸ry pokochasz.',
                premiumFeatures: 'Funkcje Premium',
                premiumFeaturesDesc: 'SMS powiadomienia, synchronizacja kalendarza, unlimited ulubione i priorytetowe wsparcie klienta za tylko 19,99 z/miesic.',
                multilingual: 'Wielojzyczno',
                multilingualDesc: 'Dostpne w jzyku angielskim i polskim z kolejnymi jzykami wkr贸tce. Dowiadcz EventFinder w Twoim preferowanym jzyku.',
                mobileFirst: 'Mobile First',
                mobileFirstDesc: 'Peni responsywny design kt贸ry dziaa perfekcyjnie na wszystkich urzdzeniach. Znajd藕 i zarezerwuj eventy w podr贸偶y z naszym mobile-optymalizowanym interfejsem.',
                platformStatistics: 'Statystyki Platformy',
                eventsAvailable: 'Dostpnych Event贸w',
                liveUpdates: 'Aktualizacje Na 呕ywo',
                getInTouch: 'Skontaktuj si z nami',
                questionsContact: 'Masz pytania lub sugestie? Chcielibymy usysze od Ciebie!',
                followTwitter: 'led藕 nas na Twitterze'
            }
        };

        function switchLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('preferredLanguage', lang);
            
            // Update HTML lang attribute
            document.documentElement.lang = lang;
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[onclick="switchLanguage('${lang}')"]`).classList.add('active');
            
            // Update page content
            updatePageLanguage();
            
            // Show notification
            const langName = lang === 'en' ? 'English' : 'Polski';
            showNotification(` Language changed to ${langName}`, 'success');
            
            // Track language change
            if (typeof gtag !== 'undefined') {
                gtag('event', 'language_change', {
                    'event_category': 'localization',
                    'event_label': lang
                });
            }
        }

        function updatePageLanguage() {
            const t = translations[currentLanguage];
            
            // Update navigation
            const navLinks = document.querySelectorAll('.nav-links a');
            const navKeys = ['home', 'search', 'events', 'map', 'about'];
            navLinks.forEach((link, index) => {
                if (navKeys[index] && t[navKeys[index]]) {
                    link.textContent = t[navKeys[index]];
                }
            });
            
            // Update hero section
            const heroTitle = document.querySelector('.hero h1');
            const heroSubtitle = document.querySelector('.hero p');
            if (heroTitle) heroTitle.textContent = t.heroTitle;
            if (heroSubtitle) heroSubtitle.textContent = t.heroSubtitle;
            
            // Update global counter
            const counterLabel = document.querySelector('.counter-label');
            const counterSublabel = document.querySelector('.counter-sublabel');
            if (counterLabel) counterLabel.textContent = t.eventsWorldwide;
            if (counterSublabel) counterSublabel.textContent = t.availableNow;
            
            // Update counter stats
            const statLabels = document.querySelectorAll('.stat-label');
            const statKeys = ['countries', 'cities', 'today'];
            statLabels.forEach((label, index) => {
                if (statKeys[index] && t[statKeys[index]]) {
                    label.textContent = t[statKeys[index]];
                }
            });
            
            // Update search form
            updateSearchForm(t);
            
            // Update other elements dynamically
            updateDynamicElements(t);
            
            // Update About section
            updateAboutSection(t);
            
            // Update event card button texts
            updateEventButtonTexts(t);
        }

        function updateEventButtonTexts(t) {
            // Update Buy Tickets buttons
            document.querySelectorAll('.btn-text-tickets').forEach(btn => {
                btn.textContent = t.buyTickets;
            });
            
            // Update Merch buttons
            document.querySelectorAll('.btn-text-merch').forEach(btn => {
                btn.textContent = t.merch;
            });
            
            // Update Follow buttons
            document.querySelectorAll('.btn-text-follow').forEach(btn => {
                btn.textContent = t.follow;
            });
        }

        function updateAboutSection(t) {
            // Update About section title
            const aboutTitle = document.querySelector('#about h2');
            if (aboutTitle) {
                aboutTitle.innerHTML = ` ${t.aboutEventfinder}`;
            }
            
            // Update About subtitle
            const aboutSubtitle = document.querySelector('#about .about-content p');
            if (aboutSubtitle) {
                aboutSubtitle.textContent = t.aboutSubtitle;
            }
            
            // Update feature cards
            const featureCards = document.querySelectorAll('#about .feature-card');
            const featureData = [
                { emoji: '', title: t.globalEvents, desc: t.globalEventsDesc },
                { emoji: '猴', title: t.interactiveMap, desc: t.interactiveMapDesc },
                { emoji: '猸', title: t.smartRecommendations, desc: t.smartRecommendationsDesc },
                { emoji: '', title: t.premiumFeatures, desc: t.premiumFeaturesDesc },
                { emoji: '', title: t.multilingual, desc: t.multilingualDesc },
                { emoji: '', title: t.mobileFirst, desc: t.mobileFirstDesc }
            ];
            
            featureCards.forEach((card, index) => {
                if (featureData[index]) {
                    const title = card.querySelector('h3');
                    const desc = card.querySelector('p');
                    if (title) title.textContent = featureData[index].title;
                    if (desc) desc.textContent = featureData[index].desc;
                }
            });
            
            // Update stats section
            const statsTitle = document.querySelector('#about .stats-section h3');
            if (statsTitle) {
                statsTitle.textContent = t.platformStatistics;
            }
            
            const statsLabels = document.querySelectorAll('#about .stats-section .stat-label, #about [style*="font-size: 0.9rem"]');
            const statsKeys = [t.eventsAvailable, t.countries, t.cities, t.liveUpdates];
            statsLabels.forEach((label, index) => {
                if (statsKeys[index] && label.textContent && !label.textContent.match(/\d/)) {
                    label.textContent = statsKeys[index];
                }
            });
            
            // Update contact section
            const contactTitle = document.querySelector('#about .contact-section h3');
            if (contactTitle) {
                contactTitle.textContent = t.getInTouch;
            }
            
            const contactDesc = document.querySelector('#about .contact-section p');
            if (contactDesc) {
                contactDesc.textContent = t.questionsContact;
            }
            
            const twitterLink = document.querySelector('#about a[href*="twitter"]');
            if (twitterLink) {
                twitterLink.innerHTML = ` ${t.followTwitter}`;
            }
        }

        function updateSearchForm(t) {
            // Update search labels
            const searchLabels = document.querySelectorAll('.search-group label');
            const labelKeys = ['keyword', 'country', 'city', 'date'];
            searchLabels.forEach((label, index) => {
                if (labelKeys[index] && t[labelKeys[index]]) {
                    const icon = label.innerHTML.split(' ')[0]; // Keep the emoji
                    label.innerHTML = `${icon} ${t[labelKeys[index]]}`;
                }
            });
            
            // Update placeholders
            const keywordInput = document.getElementById('keyword');
            const cityInput = document.getElementById('city');
            const searchBtn = document.querySelector('.search-btn');
            
            if (keywordInput) keywordInput.placeholder = t.keywordPlaceholder;
            if (cityInput) cityInput.placeholder = t.cityPlaceholder;
            if (searchBtn) {
                searchBtn.innerHTML = `<i class="fas fa-search"></i> ${t.searchEvents}`;
            }
            
            // Update country dropdown
            const countrySelect = document.getElementById('country');
            if (countrySelect && countrySelect.options[0]) {
                countrySelect.options[0].text = ` ${t.worldwide}`;
            }
        }

        function updateDynamicElements(t) {
            // Update results title
            const resultsTitle = document.querySelector('.results-title');
            if (resultsTitle && resultsTitle.textContent.includes('Results') || resultsTitle.textContent.includes('Wyniki')) {
                resultsTitle.textContent = t.searchResults;
            }
            
            // Update toggle buttons
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            if (toggleBtns[0]) toggleBtns[0].innerHTML = `<i class="fas fa-th-large"></i> ${t.grid}`;
            if (toggleBtns[1]) toggleBtns[1].innerHTML = `<i class="fas fa-map"></i> ${t.map}`;
            
            // Update map title
            const mapTitle = document.querySelector('.map-title');
            if (mapTitle) mapTitle.textContent = `猴 ${t.eventsMap}`;
            
            // Update recommendations section
            const recSection = document.querySelector('.recommendations-section h2');
            if (recSection) recSection.textContent = ` ${t.recommendedForYou}`;
            
            const recSubtitle = document.querySelector('.recommendations-section p');
            if (recSubtitle) recSubtitle.textContent = t.basedOnPreferences;
        }

        // Initialize language on page load
        function initializeLanguage() {
            // Update HTML lang attribute
            document.documentElement.lang = currentLanguage;
            
            // Set active button based on current language
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[onclick="switchLanguage('${currentLanguage}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Update page content
            updatePageLanguage();
        }
    </script>

    <!-- GDPR Cookie Consent -->
    <div id="cookie-consent" style="
        position: fixed; 
        bottom: 0; 
        left: 0; 
        right: 0; 
        background: linear-gradient(135deg, rgba(26, 29, 58, 0.98), rgba(108, 92, 231, 0.95)); 
        color: white; 
        padding: 1.5rem; 
        z-index: 10000;
        backdrop-filter: blur(10px);
        border-top: 1px solid rgba(108, 92, 231, 0.3);
        box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.3);
    ">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
            <div style="flex: 1; min-width: 300px;">
                <p style="margin: 0; color: var(--text-light); font-size: 0.95rem;">
                     This site uses cookies and Google AdSense to personalize ads and analyze traffic. 
                    <a href="polityka-prywatnosci.html" style="color: var(--primary-cyan); text-decoration: none;">Privacy Policy</a>
                </p>
            </div>
            <div style="display: flex; gap: 1rem;">
                <button onclick="declineCookies()" style="
                    background: rgba(255, 255, 255, 0.1); 
                    color: white; 
                    border: 1px solid rgba(255, 255, 255, 0.2); 
                    padding: 0.8rem 1.5rem; 
                    border-radius: 8px; 
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">
                    Decline
                </button>
                <button onclick="acceptCookies()" style="
                    background: var(--gradient-primary); 
                    color: white; 
                    border: none; 
                    padding: 0.8rem 1.5rem; 
                    border-radius: 8px; 
                    cursor: pointer;
                    font-weight: 600;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
                ">
                    Accept
                </button>
            </div>
        </div>
    </div>

    <script>
        function acceptCookies() {
            localStorage.setItem('cookiesAccepted', 'true');
            document.getElementById('cookie-consent').style.display = 'none';
            
            // Load AdSense after consent
            loadAdSense();
            
            // Track consent
            if (typeof gtag !== 'undefined') {
                gtag('event', 'cookie_consent', {
                    'event_category': 'privacy',
                    'event_label': 'accepted'
                });
            }
            
            showNotification(' Cookie settings saved!', 'success');
        }

        function declineCookies() {
            localStorage.setItem('cookiesAccepted', 'false');
            document.getElementById('cookie-consent').style.display = 'none';
            
            // Track decline
            if (typeof gtag !== 'undefined') {
                gtag('event', 'cookie_consent', {
                    'event_category': 'privacy',
                    'event_label': 'declined'
                });
            }
            
            showNotification(' Cookies declined. Some features may be limited.', 'info');
        }

        // Check if cookies already handled
        if (localStorage.getItem('cookiesAccepted') === 'true') {
            document.getElementById('cookie-consent').style.display = 'none';
            loadAdSense();
        } else if (localStorage.getItem('cookiesAccepted') === 'false') {
            document.getElementById('cookie-consent').style.display = 'none';
        }

        function loadAdSense() {
            // This will be activated when you get your Publisher ID
            console.log('AdSense ready to load with Publisher ID');
            
            // Initialize ad revenue tracking
            setTimeout(() => {
                initAdRevenueTracking();
            }, 2000);
            
            /* 
            // AdSense script already loaded in head with Publisher ID
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9110227480064306';
            script.crossOrigin = 'anonymous';
            document.head.appendChild(script);
            */
        }

        // Ad Revenue Tracking System
        function initAdRevenueTracking() {
            // Track ad impressions
            const adSlots = document.querySelectorAll('.ad-banner, .sidebar-ad-slot, .native-ad-card');
            
            const adObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const adType = entry.target.classList.contains('native-ad-card') ? 'native' : 
                                     entry.target.classList.contains('sidebar-ad-slot') ? 'sidebar' : 'banner';
                        
                        // Track ad impression
                        if (typeof gtag !== 'undefined') {
                            gtag('event', 'ad_impression', {
                                'event_category': 'monetization',
                                'event_label': adType,
                                'custom_parameter_1': 'adsense'
                            });
                        }
                        
                        // Store impression for revenue calculation
                        const impressions = JSON.parse(localStorage.getItem('adImpressions') || '{}');
                        const today = new Date().toISOString().split('T')[0];
                        
                        if (!impressions[today]) impressions[today] = {};
                        if (!impressions[today][adType]) impressions[today][adType] = 0;
                        impressions[today][adType]++;
                        
                        localStorage.setItem('adImpressions', JSON.stringify(impressions));
                        
                        console.log(` Ad impression tracked: ${adType} - Daily count: ${impressions[today][adType]}`);
                    }
                });
            }, { threshold: 0.5 });
            
            adSlots.forEach(slot => adObserver.observe(slot));
        }

        // Calculate estimated daily revenue (call in console)
        function calculateEstimatedRevenue() {
            const impressions = JSON.parse(localStorage.getItem('adImpressions') || '{}');
            const today = new Date().toISOString().split('T')[0];
            const todayImpressions = impressions[today] || {};
            
            // CPM rates (z per 1000 impressions) - realistic for Poland
            const cpmRates = {
                banner: 6,    // Top banner - highest visibility
                sidebar: 4,   // Desktop sidebar
                native: 8     // Native ads - best performance
            };
            
            let totalRevenue = 0;
            let breakdown = {};
            
            Object.keys(todayImpressions).forEach(adType => {
                const impressionCount = todayImpressions[adType];
                const revenue = (impressionCount / 1000) * cpmRates[adType];
                totalRevenue += revenue;
                breakdown[adType] = {
                    impressions: impressionCount,
                    revenue: revenue.toFixed(2) + ' z'
                };
            });
            
            console.log(' Daily Revenue Estimate:', {
                total: totalRevenue.toFixed(2) + ' z',
                breakdown: breakdown,
                monthlyProjection: (totalRevenue * 30).toFixed(2) + ' z'
            });
            
            return { total: totalRevenue, breakdown: breakdown };
        }
    </script>
</body>
</html>